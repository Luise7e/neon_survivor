# Gu√≠a de Compilaci√≥n de Neon Survivor para Android

**Proyecto:** Neon Survivor Arena
**Fecha de Creaci√≥n:** 20 de Octubre de 2025
**Plataforma:** Apache Cordova 14.0.1 para Android
**Estado:** ‚úÖ Funcional

---

## üìã Tabla de Contenidos

1. [Resumen del Proyecto](#resumen-del-proyecto)
2. [Requisitos del Sistema](#requisitos-del-sistema)
3. [Problemas Encontrados y Soluciones](#problemas-encontrados-y-soluciones)
4. [Proceso de Compilaci√≥n Exitoso](#proceso-de-compilaci√≥n-exitoso)
5. [Estructura del Proyecto](#estructura-del-proyecto)
6. [Comandos √ötiles](#comandos-√∫tiles)
7. [Troubleshooting](#troubleshooting)

---

## üéÆ Resumen del Proyecto

Neon Survivor Arena es un juego web HTML5 que ha sido portado a Android usando Apache Cordova. El juego incluye:

- **Motor:** HTML5 Canvas + JavaScript ES6+
- **Controles M√≥viles:** Joystick virtual y bot√≥n de habilidad
- **Mec√°nica de Disparo:** Tap-to-shoot (tocar en cualquier parte de la pantalla)
- **Responsive Design:** Se adapta a diferentes tama√±os de pantalla

### Modificaciones Realizadas

1. **Eliminaci√≥n del bot√≥n de disparo m√≥vil:** Se removi√≥ el bot√≥n dedicado de disparo
2. **Implementaci√≥n de tap-to-shoot:** El jugador dispara tocando cualquier lugar de la pantalla
3. **Preservaci√≥n del bot√≥n de habilidad:** Se mantuvo el bot√≥n de habilidad especial

---

## üíª Requisitos del Sistema

### Software Necesario

| Herramienta | Versi√≥n | Ruta de Instalaci√≥n |
|-------------|---------|---------------------|
| **Java JDK** | 17 | `C:\Program Files\Java\jdk-17` |
| **Android SDK** | Latest | `C:\Users\LuisCastellanoGuzman\AppData\Local\Android\sdk` |
| **Android Build Tools** | 35.0.0 y 36.1.0 | `%ANDROID_HOME%\build-tools\` |
| **Gradle** | 8.13 / 9.1.0 | Incluido en Cordova |
| **Node.js** | Latest LTS | Sistema |
| **Cordova CLI** | Latest | `npm install -g cordova` |
| **Apache Cordova Android** | 14.0.1 | Gestionado por Cordova |

### Configuraci√≥n de Variables de Entorno

```powershell
$env:JAVA_HOME = "C:\Program Files\Java\jdk-17"
$env:ANDROID_HOME = "C:\Users\LuisCastellanoGuzman\AppData\Local\Android\sdk"
$env:PATH = "$env:JAVA_HOME\bin;$env:ANDROID_HOME\platform-tools;$env:ANDROID_HOME\build-tools\35.0.0;$env:PATH"
```

---

## üêõ Problemas Encontrados y Soluciones

### **Problema 1: Incompatibilidad de Versi√≥n de JDK**

**Error:**
```
Unsupported class file major version 69
```

**Causa:**
Gradle 8.13 no es compatible con JDK 25 (class file major version 69). Cordova Android 14.0.1 requiere JDK 17.

**Soluci√≥n:**
1. Instalar JDK 17
2. Configurar `gradle.properties`:
   ```properties
   org.gradle.java.home=C:\\Program Files\\Java\\jdk-17
   ```
3. Establecer `JAVA_HOME` antes de cada compilaci√≥n:
   ```powershell
   $env:JAVA_HOME="C:\Program Files\Java\jdk-17"
   ```

**Archivos Modificados:**
- `neon-survivor/platforms/android/gradle.properties`

---

### **Problema 2: Build Tools No Encontradas**

**Error:**
```
No installed build tools found. Install the Android build tools version 35.0.0 or higher.
```

**Causa:**
Cordova buscaba espec√≠ficamente la versi√≥n 35.0.0 de build-tools, pero solo estaba instalada la 36.1.0.

**Soluci√≥n Temporal:**
```powershell
# Copiar la versi√≥n 36.1.0 como 35.0.0
Copy-Item "$env:ANDROID_HOME\build-tools\36.1.0" "$env:ANDROID_HOME\build-tools\35.0.0" -Recurse
```

**Soluci√≥n Permanente:**
- Actualizar `cdv-gradle-config.json` para usar la versi√≥n correcta:
  ```json
  {
    "MIN_BUILD_TOOLS_VERSION": "36.0.0",
    "COMPILE_SDK_VERSION": 35
  }
  ```

**Archivos Modificados:**
- `neon-survivor/platforms/android/cdv-gradle-config.json`

---

### **Problema 3: Error de Manifest XML Parse**

**Error:**
```
ParseError at [row,col]:[12,60]
Message: The prefix "android" for element "android:gradlePluginVersion" is not bound.
```

**Causa:**
Sintaxis XML inv√°lida en `config.xml`. Se intent√≥ usar `<edit-config>` con atributos no soportados.

**Soluci√≥n:**
Eliminar el bloque `<edit-config>` problem√°tico del `config.xml`:

```xml
<!-- ELIMINAR ESTO -->
<edit-config file="app/build.gradle" target="/*" mode="overwrite">
    <preference name="android-targetSdkVersion" value="35" />
    <preference name="android-minSdkVersion" value="24" />
</edit-config>
```

Usar en su lugar solo las preferencias est√°ndar:
```xml
<preference name="android-targetSdkVersion" value="35" />
<preference name="android-minSdkVersion" value="24" />
```

**Archivos Modificados:**
- `neon-survivor/config.xml`

---

### **Problema 4: Error de Instalaci√≥n - No Certificates**

**Error:**
```
INSTALL_PARSE_FAILED_NO_CERTIFICATES: Scanning Failed.: no signature found in package of version 2 or newer
```

**Causa:**
Usar `jarsigner` solo genera firmas v1 (JAR signing), pero Android 7.0+ requiere firmas v2/v3 (APK Signature Scheme).

**Soluci√≥n Incorrecta:**
```powershell
# ‚ùå NO USAR - Solo genera firma v1
jarsigner -verbose -sigalg SHA256withRSA -digestalg SHA-256 \
  -keystore my-release-key.keystore app-release.apk my-key-alias
```

**Soluci√≥n Correcta:**
```powershell
# ‚úÖ USAR - Genera firmas v2 y v3
apksigner sign --ks my-release-key.keystore \
  --ks-key-alias my-key-alias \
  --ks-pass pass:password123 \
  --key-pass pass:password123 \
  --out NeonSurvivor-FINAL.apk \
  app-release-unsigned.apk
```

**Verificaci√≥n:**
```powershell
apksigner verify --verbose NeonSurvivor-FINAL.apk
```

**Salida Esperada:**
```
Verified using v2 scheme (APK Signature Scheme v2): true
Verified using v3 scheme (APK Signature Scheme v3): true
```

---

### **Problema 5: Error de Instalaci√≥n - Manifest Malformed**

**Error:**
```
error -124 INSTALL_PARSE_FAILED_MANIFEST_MALFORMED
Targeting R+ (version 30 and above) requires the resources.arsc of installed APKs to be stored uncompressed
```

**Causa:**
El `targetSdkVersion` no estaba configurado correctamente para Android 11+ (API 30+).

**Soluci√≥n:**
1. Asegurar que `config.xml` tenga:
   ```xml
   <preference name="android-targetSdkVersion" value="35" />
   ```

2. Regenerar la plataforma Android:
   ```powershell
   cordova platform remove android
   cordova platform add android
   ```

3. Verificar que `AndroidManifest.xml` generado tenga:
   ```xml
   <uses-sdk android:minSdkVersion="24" android:targetSdkVersion="35" />
   ```

**Archivos Modificados:**
- `neon-survivor/config.xml`
- `neon-survivor/platforms/android/app/src/main/AndroidManifest.xml` (generado autom√°ticamente)

---

## ‚úÖ Proceso de Compilaci√≥n Exitoso

### Paso 1: Preparar el Entorno

```powershell
# Establecer variables de entorno
$env:JAVA_HOME = "C:\Program Files\Java\jdk-17"
$env:ANDROID_HOME = "C:\Users\LuisCastellanoGuzman\AppData\Local\Android\sdk"
$env:PATH = "C:\Program Files (x86)\Gradle\bin;$env:JAVA_HOME\bin;$env:ANDROID_HOME\platform-tools;$env:PATH"

# Navegar al proyecto Cordova
cd c:\Users\LuisCastellanoGuzman\neon_survivor\neon-survivor
```

### Paso 2: Limpiar y Regenerar Plataforma (Si es necesario)

```powershell
# Solo si hay problemas con configuraci√≥n anterior
cordova platform remove android
cordova platform add android
```

### Paso 3: Compilar APK Sin Firmar

```powershell
# Compilar directamente con Gradle
cd platforms\android
cmd /c gradlew.bat assembleRelease
```

**Salida esperada:**
```
BUILD SUCCESSFUL in 8s
82 actionable tasks: 30 executed, 52 up-to-date
```

**APK generado en:**
```
platforms\android\app\build\outputs\apk\release\app-release-unsigned.apk
```

### Paso 4: Firmar el APK

```powershell
# Navegar a la carpeta del APK
cd platforms\android\app\build\outputs\apk\release

# Firmar con apksigner (NO con jarsigner)
$env:ANDROID_HOME = "C:\Users\LuisCastellanoGuzman\AppData\Local\Android\sdk"
& "$env:ANDROID_HOME\build-tools\35.0.0\apksigner.bat" sign `
  --ks "C:\Users\LuisCastellanoGuzman\neon_survivor\my-release-key.keystore" `
  --ks-key-alias my-key-alias `
  --ks-pass pass:password123 `
  --key-pass pass:password123 `
  --out "C:\Users\LuisCastellanoGuzman\neon_survivor\NeonSurvivor-FINAL.apk" `
  app-release-unsigned.apk
```

### Paso 5: Verificar la Firma

```powershell
& "$env:ANDROID_HOME\build-tools\35.0.0\apksigner.bat" verify --verbose `
  "C:\Users\LuisCastellanoGuzman\neon_survivor\NeonSurvivor-FINAL.apk"
```

**Salida esperada:**
```
Verifies
Verified using v2 scheme (APK Signature Scheme v2): true
Verified using v3 scheme (APK Signature Scheme v3): true
Number of signers: 1
```

### Paso 6: Instalar en Dispositivo/Emulador

```powershell
# Opci√≥n 1: Instalar con adb
adb install C:\Users\LuisCastellanoGuzman\neon_survivor\NeonSurvivor-FINAL.apk

# Opci√≥n 2: Arrastrar el APK al emulador de Android Studio
```

---

## üìÅ Estructura del Proyecto

```
neon_survivor/
‚îú‚îÄ‚îÄ neon-survivor/                          # Proyecto Cordova
‚îÇ   ‚îú‚îÄ‚îÄ config.xml                          # Configuraci√≥n de Cordova
‚îÇ   ‚îú‚îÄ‚îÄ package.json                        # Dependencias Node.js
‚îÇ   ‚îú‚îÄ‚îÄ platforms/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ android/                        # Plataforma Android generada
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ gradle.properties           # Configuraci√≥n de Gradle (JDK)
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ cdv-gradle-config.json      # Versiones de build tools
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ app/
‚îÇ   ‚îÇ           ‚îî‚îÄ‚îÄ build/
‚îÇ   ‚îÇ               ‚îî‚îÄ‚îÄ outputs/
‚îÇ   ‚îÇ                   ‚îî‚îÄ‚îÄ apk/
‚îÇ   ‚îÇ                       ‚îî‚îÄ‚îÄ release/
‚îÇ   ‚îÇ                           ‚îî‚îÄ‚îÄ app-release-unsigned.apk
‚îÇ   ‚îú‚îÄ‚îÄ www/                                # Archivos web del juego
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ index.html                      # P√°gina principal
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ game.js                         # L√≥gica del juego
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ css/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.css                   # Estilos m√≥viles
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ js/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ index.js                    # Inicializaci√≥n Cordova
‚îÇ   ‚îî‚îÄ‚îÄ plugins/                            # Plugins de Cordova
‚îÇ
‚îú‚îÄ‚îÄ my-release-key.keystore                 # Keystore para firmar APKs
‚îú‚îÄ‚îÄ NeonSurvivor-v4.apk                     # APK final firmado (USAR ESTE)
‚îú‚îÄ‚îÄ CORDOVA_BUILD_GUIDE.md                  # Este documento
‚îî‚îÄ‚îÄ README.md                               # Documentaci√≥n original

```

---

## üîß Comandos √ötiles

### Gesti√≥n de Plataforma

```powershell
# Listar plataformas instaladas
cordova platform list

# Agregar plataforma Android
cordova platform add android

# Remover plataforma Android
cordova platform remove android

# Actualizar plataforma Android
cordova platform update android
```

### Compilaci√≥n

```powershell
# Debug build (sin firmar)
cordova build android

# Release build (requiere firma)
cordova build android --release

# Compilaci√≥n directa con Gradle
cd platforms\android
gradlew.bat assembleRelease
gradlew.bat assembleDebug
```

### Firma de APKs

```powershell
# Crear keystore (solo primera vez)
keytool -genkey -v -keystore my-release-key.keystore `
  -alias my-key-alias `
  -keyalg RSA `
  -keysize 2048 `
  -validity 10000

# Firmar APK con apksigner
apksigner sign --ks my-release-key.keystore `
  --ks-key-alias my-key-alias `
  --out signed.apk unsigned.apk

# Verificar firma
apksigner verify --verbose signed.apk
```

### Instalaci√≥n y Testing

```powershell
# Listar dispositivos conectados
adb devices

# Instalar APK
adb install path\to\app.apk

# Reinstalar APK (mantiene datos)
adb install -r path\to\app.apk

# Desinstalar app
adb uninstall com.tuempresa.neonsurvivor

# Ver logs en tiempo real
adb logcat
```

---

## üîç Troubleshooting

### El build falla con error de JDK

**S√≠ntoma:**
```
Unsupported class file major version XX
```

**Soluci√≥n:**
1. Verificar versi√≥n de Java:
   ```powershell
   java -version
   ```
2. Asegurar que `JAVA_HOME` apunta a JDK 17:
   ```powershell
   $env:JAVA_HOME = "C:\Program Files\Java\jdk-17"
   ```
3. Verificar `gradle.properties` tiene la l√≠nea correcta

### El APK no se instala: "INSTALL_PARSE_FAILED"

**Soluci√≥n:**
- ‚úÖ Usar `apksigner` en lugar de `jarsigner`
- ‚úÖ Verificar que las firmas v2/v3 est√©n presentes
- ‚úÖ Asegurar que `targetSdkVersion` sea 35 o superior

### Build Tools no encontradas

**Soluci√≥n:**
1. Instalar build-tools 35.0.0:
   ```powershell
   sdkmanager "build-tools;35.0.0"
   ```
2. O copiar versi√≥n m√°s nueva como 35.0.0

### Error "cordova: command not found"

**Soluci√≥n:**
```powershell
npm install -g cordova
```

### Gradle Daemon usa mucha memoria

**Soluci√≥n:**
Agregar a `gradle.properties`:
```properties
org.gradle.jvmargs=-Xmx2048m -XX:MaxMetaspaceSize=512m
org.gradle.daemon=true
org.gradle.parallel=true
```

---

## üìù Notas Adicionales

### Informaci√≥n del Keystore

- **Ubicaci√≥n:** `C:\Users\LuisCastellanoGuzman\neon_survivor\my-release-key.keystore`
- **Alias:** `my-key-alias`
- **Contrase√±a:** `password123`
- **Validez:** 28 a√±os (hasta 2053-03-07)
- **Algoritmo:** SHA256withRSA (2048-bit)

### Configuraci√≥n del Proyecto

**config.xml - Preferencias Clave:**
```xml
<preference name="android-targetSdkVersion" value="35" />
<preference name="android-minSdkVersion" value="24" />
```

**Package ID:**
```xml
<widget id="com.tuempresa.neonsurvivor" version="1.0.0">
```

### Versiones Compatibles Verificadas

| Componente | Versi√≥n | Estado |
|------------|---------|--------|
| Cordova CLI | 14.0.1 | ‚úÖ Funciona |
| cordova-android | 14.0.1 | ‚úÖ Funciona |
| JDK | 17 | ‚úÖ Funciona |
| JDK | 25 | ‚ùå No compatible |
| Gradle | 8.13 | ‚úÖ Funciona |
| Android SDK | 35 | ‚úÖ Funciona |
| Build Tools | 35.0.0 | ‚úÖ Funciona |
| Build Tools | 36.1.0 | ‚úÖ Funciona |

---

## üéØ Checklist para Futuras Compilaciones

Antes de compilar, verificar:

- [ ] `JAVA_HOME` apunta a JDK 17
- [ ] `ANDROID_HOME` est√° configurado correctamente
- [ ] Build tools 35.0.0 est√°n instalados
- [ ] `config.xml` tiene `targetSdkVersion` correcto
- [ ] `gradle.properties` tiene `org.gradle.java.home` configurado
- [ ] Keystore est√° disponible y accesible

Para compilar:

- [ ] Limpiar plataforma si hay cambios de configuraci√≥n
- [ ] Compilar con `gradlew.bat assembleRelease`
- [ ] Firmar con `apksigner` (NO jarsigner)
- [ ] Verificar firma con `apksigner verify`
- [ ] Probar instalaci√≥n en emulador

---

## üìû Contacto y Recursos

### Documentaci√≥n Oficial

- [Apache Cordova Docs](https://cordova.apache.org/docs/en/latest/)
- [Cordova Android Platform Guide](https://cordova.apache.org/docs/en/latest/guide/platforms/android/)
- [Android Developer Guides](https://developer.android.com/guide)

### Comandos de Ayuda

```powershell
cordova --help
cordova build --help
apksigner --help
```

---

**√öltima actualizaci√≥n:** 20 de Octubre de 2025
**Autor:** GitHub Copilot
**Versi√≥n del Documento:** 1.0

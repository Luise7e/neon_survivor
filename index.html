<!DOCTYPE html>
<html lang="es">
<head>
            <!-- Firebase App (compat) -->
            <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
            <!-- Firebase Auth (compat) -->
            <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
            <!-- Firestore (compat) -->
            <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
            <script>
                // Configuraci√≥n de Firebase
                const firebaseConfig = {
                    apiKey: "AIzaSyCUwlvMjqBljR68JlBYGzJwvttWg2AvEdM",
                    authDomain: "neon-survivor-fdb4c.firebaseapp.com",
                    projectId: "neon-survivor-fdb4c",
                    storageBucket: "neon-survivor-fdb4c.appspot.com",
                    messagingSenderId: "843900625599",
                    appId: "1:843900625599:web:222c0618acc6c2112a1c0a",
                    measurementId: "G-YVZY35ZYSW"
                };
                firebase.initializeApp(firebaseConfig);
                const auth = firebase.auth();
                const db = firebase.firestore();
            </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <title>NEON SURVIVOR ARENA | Universal Battle Royale</title>
    <link rel="manifest" href="manifest.json">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@600;700&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            -webkit-user-select: none;
        }

        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            position: fixed;
            background: #000;
            font-family: 'Orbitron', sans-serif;
        }

        body.desktop {
            cursor: none;
        }

        #gameCanvas {
            display: block;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            touch-action: none;
            background: radial-gradient(circle at 50% 50%, #0f0f2e 0%, #000000 100%);
        }

        /* Custom Cursor (PC only) */
        .custom-cursor {
            position: fixed;
            pointer-events: none;
            z-index: 10000;
            mix-blend-mode: difference;
            display: none;
        }

        .custom-cursor.active {
            display: block;
        }

        .cursor-dot {
            width: 8px;
            height: 8px;
            background: #00ffff;
            border-radius: 50%;
            position: absolute;
            transform: translate(-50%, -50%);
            box-shadow: 0 0 20px #00ffff, 0 0 40px #00ffff;
            animation: pulse-cursor 1s infinite;
        }

        .cursor-ring {
            width: 32px;
            height: 32px;
            border: 2px solid #ff00ff;
            border-radius: 50%;
            position: absolute;
            transform: translate(-50%, -50%);
            transition: all 0.1s ease;
            box-shadow: 0 0 20px #ff00ff;
        }

        @keyframes pulse-cursor {
            0%, 100% { transform: translate(-50%, -50%) scale(1); }
            50% { transform: translate(-50%, -50%) scale(1.2); }
        }

        /* =========================
           MOBILE CONTROLS
        ========================= */
        .mobile-controls {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 280px;
            z-index: 500;
            pointer-events: none;
            display: none;
        }

        .mobile-controls.active {
            display: block;
        }

        /* Joystick Container - FIXED TOUCH AREA */
        .joystick-container {
            position: absolute;
            bottom: 30px;
            left: 30px;
            width: 120px;
            height: 120px;
            pointer-events: none; /* El contenedor no captura eventos */
        }

        .joystick-base {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: radial-gradient(circle at center, rgba(0, 255, 255, 0.12) 0%, rgba(0, 255, 255, 0.03) 100%);
            border: 2px solid rgba(0, 255, 255, 0.3);
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.2), inset 0 0 15px rgba(0, 255, 255, 0.08);
            pointer-events: all; /* Solo la base captura eventos */
            touch-action: none;
        }

        .joystick-stick {
            position: absolute;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, #00ffff 0%, #0099ff 100%);
            border: 2px solid #ffffff;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.7), 0 4px 12px rgba(0, 0, 0, 0.5);
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            transition: all 0.05s ease-out;
            pointer-events: none; /* El stick no interfiere */
        }

        .joystick-stick.active {
            transform: translate(-50%, -50%) scale(1.1);
            box-shadow: 0 0 30px rgba(0, 255, 255, 1), 0 4px 15px rgba(0, 0, 0, 0.7);
        }

        /* Pause Button - NEON STYLE */
        .pause-btn-mobile {
            position: absolute;
            bottom: 165px;
            left: 30px;
            width: 45px;
            height: 45px;
            border-radius: 8px;
            background: linear-gradient(135deg, rgba(10, 10, 40, 0.9) 0%, rgba(40, 0, 60, 0.9) 100%);
            border: 2px solid;
            border-image: linear-gradient(135deg, #00ffff, #ff00ff) 1;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 0 20px rgba(255, 0, 255, 0.5), inset 0 0 15px rgba(0, 255, 255, 0.1);
            cursor: pointer;
            transition: all 0.2s ease;
            pointer-events: all;
            backdrop-filter: blur(10px);
        }

        .pause-btn-mobile::before,
        .pause-btn-mobile::after {
            content: '';
            position: absolute;
            width: 5px;
            height: 20px;
            background: linear-gradient(180deg, #00ffff, #ff00ff);
            border-radius: 2px;
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.8);
        }

        .pause-btn-mobile::before {
            left: 14px;
        }

        .pause-btn-mobile::after {
            right: 14px;
        }

        .pause-btn-mobile:active {
            transform: scale(0.9);
            box-shadow: 0 0 30px rgba(255, 0, 255, 0.8), inset 0 0 20px rgba(0, 255, 255, 0.2);
        }

        .pause-btn-mobile:active::before,
        .pause-btn-mobile:active::after {
            box-shadow: 0 0 15px rgba(0, 255, 255, 1);
        }

        /* Action Buttons */
        .action-buttons {
            position: absolute;
            bottom: 40px;
            right: 40px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            pointer-events: all;
        }

        .action-btn {
            width: 85px;
            height: 85px;
            border-radius: 50%;
            background: linear-gradient(135deg, rgba(255, 0, 255, 0.9) 0%, rgba(138, 0, 230, 0.9) 100%);
            border: 3px solid #ffffff;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
            color: #fff;
            box-shadow: 0 0 25px rgba(255, 0, 255, 0.7), 0 5px 15px rgba(0, 0, 0, 0.5);
            cursor: pointer;
            transition: all 0.1s ease;
            position: relative;
        }

        .action-btn.inactive {
            opacity: 0.3;
            background: linear-gradient(135deg, rgba(120, 120, 120, 0.6) 0%, rgba(80, 80, 80, 0.6) 100%);
        }

        .action-btn:active {
            transform: scale(0.9);
            box-shadow: 0 0 40px rgba(255, 0, 255, 1), 0 2px 10px rgba(0, 0, 0, 0.7);
        }

        .action-btn.shoot {
            background: linear-gradient(135deg, rgba(255, 0, 85, 0.9) 0%, rgba(255, 0, 150, 0.9) 100%);
            font-size: 28px;
        }

        .action-btn .btn-label {
            position: absolute;
            bottom: -25px;
            font-size: 10px;
            color: rgba(255, 255, 255, 0.7);
            text-transform: uppercase;
            letter-spacing: 1px;
            white-space: nowrap;
        }

        .action-btn .cooldown-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: 900;
        }

        .action-btn .cooldown-overlay.active {
            display: flex;
        }

        /* Shoot Joystick (Right Side) */
        .shoot-joystick-container {
            position: absolute;
            bottom: 30px;
            right: 30px;
            width: 120px;
            height: 120px;
            pointer-events: none;
        }

        .shoot-joystick-container .joystick-base {
            background: radial-gradient(circle at center, rgba(255, 0, 255, 0.12) 0%, rgba(255, 0, 255, 0.03) 100%);
            border: 2px solid rgba(255, 0, 255, 0.3);
            box-shadow: 0 0 20px rgba(255, 0, 255, 0.2), inset 0 0 15px rgba(255, 0, 255, 0.08);
        }

        .shoot-joystick-container .joystick-stick {
            background: linear-gradient(135deg, #ff00ff 0%, #ff0088 100%);
            box-shadow: 0 0 20px rgba(255, 0, 255, 0.7), 0 4px 12px rgba(0, 0, 0, 0.5);
        }

        .shoot-joystick-container .joystick-stick.active {
            box-shadow: 0 0 30px rgba(255, 0, 255, 1), 0 4px 15px rgba(0, 0, 0, 0.7);
        }

        /* Ability Button Small (for dual joystick mode) */
        .ability-btn-small {
            position: absolute;
            bottom: 165px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, rgba(255, 0, 255, 0.9) 0%, rgba(138, 0, 230, 0.9) 100%);
            border: 3px solid #ffffff;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            color: #fff;
            box-shadow: 0 0 20px rgba(255, 0, 255, 0.7), 0 5px 15px rgba(0, 0, 0, 0.5);
            cursor: pointer;
            transition: all 0.1s ease;
            position: absolute;
            pointer-events: all;
        }

        .ability-btn-small.inactive {
            opacity: 0.3;
            background: linear-gradient(135deg, rgba(120, 120, 120, 0.6) 0%, rgba(80, 80, 80, 0.6) 100%);
        }

        .ability-btn-small:active {
            transform: scale(0.9);
            box-shadow: 0 0 30px rgba(255, 0, 255, 1), 0 2px 10px rgba(0, 0, 0, 0.7);
        }

        .ability-btn-small .cooldown-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            font-weight: 900;
        }

        .ability-btn-small .cooldown-overlay.active {
            display: flex;
        }

        /* =========================
           HUD - RESPONSIVE (SINGLE ROW FULL WIDTH)
        ========================= */
        .hud {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            pointer-events: none;
            display: none;
            flex-direction: row;
            flex-wrap: nowrap;
            gap: 0;
            justify-content: space-between;
            background: linear-gradient(180deg, rgba(0, 0, 0, 0.95) 0%, rgba(0, 0, 0, 0.85) 80%, transparent 100%);
            padding: 8px 10px;
            border-bottom: 2px solid;
            border-image: linear-gradient(90deg, #00ffff, #ff00ff, #00ffff) 1;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.3), inset 0 -10px 30px rgba(0, 0, 0, 0.5);
        }

        .hud.active {
            display: flex;
        }

        .hud-panel {
            background: linear-gradient(135deg, rgba(10, 10, 40, 0.7) 0%, rgba(20, 0, 40, 0.7) 100%);
            border: 1px solid;
            border-image: linear-gradient(135deg, #00ffff, #ff00ff) 1;
            border-radius: 6px;
            padding: 5px 10px;
            backdrop-filter: blur(8px);
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.15), inset 0 0 8px rgba(255, 0, 255, 0.05);
            flex: 1 1 auto;
            min-width: auto;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .hud-panel.health-panel {
            flex: 1.5 1 auto;
            max-width: 160px;
        }

        @media (max-width: 768px) {
        /* Compactar controles m√≥viles para pantallas peque√±as */
        .mobile-controls {
            height: 18vh !important;
            max-height: 110px !important;
            min-height: 70px !important;
        }
        .joystick-container {
            width: 14vw !important;
            min-width: 44px !important;
            max-width: 64px !important;
            height: 14vw !important;
            min-height: 44px !important;
            max-height: 64px !important;
            left: 2vw !important;
            bottom: 2vw !important;
        }
        .joystick-stick {
            width: 22px !important;
            height: 22px !important;
        }
        .action-buttons {
            bottom: 2vw !important;
            right: 2vw !important;
            gap: 6px !important;
        }
        .action-btn {
            width: 32px !important;
            height: 32px !important;
            font-size: 10px !important;
        }
        .ability-btn-small {
            width: 18px !important;
            height: 18px !important;
            font-size: 7px !important;
            bottom: 7vh !important;
            right: 2vw !important;
        }
        }
        .hud {
            padding: 6px 8px;
        }

        .hud-panel {
            padding: 4px 6px;
            border-radius: 4px;
        }

        .hud-panel.health-panel {
            max-width: 120px;
        }


        .hud-label {
            font-size: 7px;
            color: rgba(255, 255, 255, 0.5);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 2px;
            font-family: 'Rajdhani', sans-serif;
            white-space: nowrap;
        }

        @media (max-width: 768px) {
            .hud-label {
                font-size: 6px;
                letter-spacing: 0.3px;
            }
        }

        .hud-value {
            font-size: 14px;
            font-weight: 900;
            background: linear-gradient(90deg, #00ffff, #ff00ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 0 8px rgba(0, 255, 255, 0.3);
            font-family: 'Orbitron', sans-serif;
            line-height: 1.1;
        }

        @media (max-width: 768px) {
            .hud-value {
                font-size: 12px;
            }
        }

        .health-bar-container {
            width: 100%;
            height: 8px;
            background: rgba(0, 0, 0, 0.6);
            border-radius: 4px;
            overflow: hidden;
            margin-top: 3px;
            border: 1px solid rgba(255, 255, 255, 0.15);
        }

        @media (max-width: 768px) {
            .health-bar-container {
                height: 6px;
            }
        }

        .health-bar {
            height: 100%;
            background: linear-gradient(90deg, #ff0055, #ff00ff, #8800ff);
            background-size: 200% 100%;
            transition: width 0.3s ease;
            box-shadow: 0 0 8px rgba(255, 0, 255, 0.6);
            animation: health-glow 2s ease-in-out infinite;
        }

        @keyframes health-glow {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        /* Game area constraint */
        #gameCanvas {
            display: block;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            touch-action: none;
            background: radial-gradient(circle at 50% 50%, #0f0f2e 0%, #000000 100%);
        }

        /* =========================
           LOADING SCREEN
        ========================= */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #000000 0%, #1a001a 50%, #000033 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            z-index: 10000;
            animation: bg-shift 5s ease-in-out infinite;
        }

        @keyframes bg-shift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .loading-logo {
            font-size: 60px;
            font-weight: 900;
            background: linear-gradient(45deg, #ff00ff, #00ffff, #ff00ff, #00ffff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            background-size: 300% 100%;
            animation: logo-shimmer 3s linear infinite, logo-pulse 2s ease-in-out infinite;
            margin-bottom: 30px;
            text-align: center;
            padding: 0 20px;
        }

        @media (max-width: 768px) {
            .loading-logo {
                font-size: 36px;
            }
        }

        @keyframes logo-shimmer {
            0% { background-position: 0% 0%; }
            100% { background-position: 300% 0%; }
        }

        @keyframes logo-pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .loading-subtitle {
            color: #00ffff;
            font-size: 14px;
            margin-bottom: 40px;
            text-transform: uppercase;
            letter-spacing: 3px;
            opacity: 0.8;
        }

        @media (max-width: 768px) {
            .loading-subtitle {
                font-size: 11px;
                letter-spacing: 2px;
            }
        }

        .loading-bar {
            width: 350px;
            max-width: 80%;
            height: 12px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
            border: 2px solid rgba(0, 255, 255, 0.3);
        }

        .loading-progress {
            height: 100%;
            background: linear-gradient(90deg, #ff00ff, #00ffff, #ff00ff);
            background-size: 200% 100%;
            border-radius: 10px;
            animation: loading-fill 3s ease-in-out, loading-glow 2s ease-in-out infinite;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.8);
        }

        @keyframes loading-fill {
            from { width: 0%; }
            to { width: 100%; }
        }

        @keyframes loading-glow {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .loading-instructions {
            margin-top: 30px;
            color: rgba(255, 255, 255, 0.6);
            font-size: 12px;
            text-align: center;
            line-height: 1.6;
            max-width: 500px;
            padding: 0 20px;
        }

        @media (max-width: 768px) {
            .loading-instructions {
                font-size: 10px;
            }
        }

        .loading-instructions .platform-specific {
            display: none;
        }

        .loading-instructions .platform-specific.active {
            display: inline;
        }

        /* =========================
           NOTIFICATIONS
        ========================= */
        .notification {
            position: fixed;
            top: 80px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, rgba(255, 0, 255, 0.95) 0%, rgba(0, 255, 255, 0.95) 100%);
            border: 3px solid #fff;
            border-radius: 15px;
            padding: 15px 30px;
            font-size: 18px;
            font-weight: 900;
            color: #fff;
            z-index: 5000;
            display: none;
            box-shadow: 0 0 40px rgba(255, 0, 255, 0.9);
            animation: notification-bounce 0.5s ease;
        }

        @media (max-width: 768px) {
            .notification {
                top: 60px;
                font-size: 14px;
                padding: 12px 20px;
            }
        }

        @keyframes notification-bounce {
            0%, 100% { transform: translateX(-50%) scale(1); }
            50% { transform: translateX(-50%) scale(1.1); }
        }

        /* =========================
           WAVE INDICATOR
        ========================= */
        .wave-indicator {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 80px;
            font-weight: 900;
            color: #00ffff;
            text-shadow: 0 0 60px #00ffff, 0 0 100px #ff00ff;
            z-index: 3000;
            display: none;
            animation: wave-announce 2.5s ease;
            text-align: center;
        }

        @media (max-width: 768px) {
            .wave-indicator {
                font-size: 48px;
            }
        }

        @keyframes wave-announce {
            0% { transform: translate(-50%, -50%) scale(0) rotate(-10deg); opacity: 0; }
            50% { transform: translate(-50%, -50%) scale(1.3) rotate(5deg); opacity: 1; }
            100% { transform: translate(-50%, -50%) scale(1) rotate(0deg); opacity: 0; }
        }

        /* =========================
           WAVE COUNTDOWN
        ========================= */
        .wave-countdown {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 5000;
            text-align: center;
            pointer-events: none;
        }

        .countdown-title {
            font-size: clamp(32px, 6vw, 60px);
            font-weight: 900;
            background: linear-gradient(45deg, #00ffff, #ff00ff, #00ffff);
            background-size: 200% 200%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: gradient-flow 3s ease infinite;
            margin-bottom: 20px;
            text-shadow: 0 0 30px rgba(0, 255, 255, 0.5);
        }

        .countdown-number {
            font-size: clamp(120px, 25vw, 250px);
            font-weight: 900;
            color: #00ffff;
            text-shadow:
                0 0 20px #00ffff,
                0 0 40px #00ffff,
                0 0 80px #00ffff,
                0 0 120px #ff00ff,
                0 0 160px #ff00ff;
            animation: countdown-pulse 1s ease-in-out;
            line-height: 1;
        }

        .countdown-subtitle {
            font-size: clamp(20px, 4vw, 36px);
            font-weight: 700;
            color: #ff00ff;
            text-shadow: 0 0 20px #ff00ff, 0 0 40px #ff00ff;
            margin-top: 20px;
            animation: pulse-glow 1s ease-in-out infinite;
        }

        @keyframes countdown-pulse {
            0% {
                transform: scale(0) rotate(-180deg);
                opacity: 0;
            }
            50% {
                transform: scale(1.2) rotate(10deg);
                opacity: 1;
            }
            100% {
                transform: scale(1) rotate(0deg);
                opacity: 1;
            }
        }

        @keyframes pulse-glow {
            0%, 100% {
                opacity: 0.7;
                text-shadow: 0 0 20px #ff00ff, 0 0 40px #ff00ff;
            }
            50% {
                opacity: 1;
                text-shadow: 0 0 30px #ff00ff, 0 0 60px #ff00ff, 0 0 90px #ff00ff;
            }
        }

        @keyframes gradient-flow {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        @media (max-width: 768px) {
            .countdown-title {
                margin-bottom: 10px;
            }
            .countdown-subtitle {
                margin-top: 10px;
            }
        }

        /* =========================
           GAME OVER SCREEN
        ========================= */
        .game-over {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.97);
            display: none;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            z-index: 9000;
            padding: 20px;
        }

        .game-over.active {
            display: flex;
        }

        .game-over h1 {
            font-size: 70px;
            background: linear-gradient(45deg, #ff0055, #ff00ff, #8800ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 0 50px rgba(255, 0, 255, 0.8);
            margin-bottom: 30px;
            animation: title-glow 2s ease-in-out infinite;
        }

        @media (max-width: 768px) {
            .game-over h1 {
                font-size: 42px;
            }
        }

        @keyframes title-glow {
            0%, 100% { filter: brightness(1); }
            50% { filter: brightness(1.3); }
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
            max-width: 600px;
            width: 100%;
        }

        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }
        }

        .stat-card {
            background: linear-gradient(135deg, rgba(10, 10, 40, 0.9) 0%, rgba(40, 0, 60, 0.9) 100%);
            border: 2px solid;
            border-image: linear-gradient(135deg, #00ffff, #ff00ff) 1;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: scale(1.05);
            box-shadow: 0 0 30px rgba(0, 255, 255, 0.6);
        }

        .stat-value {
            font-size: 48px;
            font-weight: 900;
            background: linear-gradient(90deg, #00ffff, #ff00ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 0 30px rgba(0, 255, 255, 0.7);
        }

        @media (max-width: 768px) {
            .stat-value {
                font-size: 36px;
            }
        }

        .stat-label {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.7);
            margin-top: 8px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .btn-neon {
            background: linear-gradient(135deg, #ff00ff, #00ffff);
            border: none;
            padding: 15px 35px;
            font-size: 18px;
            font-weight: 900;
            color: #fff;
            cursor: pointer;
            border-radius: 50px;
            font-family: 'Orbitron', sans-serif;
            box-shadow: 0 0 30px rgba(255, 0, 255, 0.6);
            transition: all 0.3s ease;
            margin: 8px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        @media (max-width: 768px) {
            .btn-neon {
                padding: 12px 25px;
                font-size: 14px;
            }
        }

        .btn-neon:hover {
            transform: scale(1.1);
            box-shadow: 0 0 50px rgba(0, 255, 255, 0.9);
        }

        .btn-neon:active {
            transform: scale(0.95);
        }
        /* =========================
           START MENU / LOGIN
        ========================= */
        /* =========================
           START MENU - REDESIGNED
        ========================= */
        .start-menu {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background:
                radial-gradient(ellipse at top, rgba(255, 0, 255, 0.15) 0%, transparent 50%),
                radial-gradient(ellipse at bottom, rgba(0, 255, 255, 0.15) 0%, transparent 50%),
                linear-gradient(180deg, #000014 0%, #0a0a1a 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            font-family: 'Orbitron', sans-serif;
            overflow: hidden;
            padding: clamp(15px, 2vh, 25px) clamp(15px, 3vw, 25px);
            gap: clamp(15px, 2.5vh, 30px);
        }

        .start-menu.hidden {
            display: none;
        }

        /* Hero Section */
        .menu-hero {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: clamp(3px, 0.8vh, 6px);
            text-align: center;
            width: 100%;
            max-width: 800px;
            flex-shrink: 0;
        }

        .menu-logo {
            font-size: clamp(28px, 7vw, 52px);
            font-weight: 900;
            background: linear-gradient(135deg, #ff00ff 0%, #00ffff 50%, #ff00ff 100%);
            background-size: 200% auto;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: gradient-shift 4s ease-in-out infinite, title-glow 3s ease-in-out infinite;
            letter-spacing: clamp(2px, 0.5vw, 3px);
            line-height: 0.95;
            filter: drop-shadow(0 0 25px rgba(255, 0, 255, 0.6));
        }

        @keyframes gradient-shift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .menu-subtitle {
            font-size: clamp(11px, 2.5vw, 16px);
            color: #00ffff;
            text-transform: uppercase;
            letter-spacing: clamp(1.5px, 0.4vw, 3px);
            text-shadow: 0 0 12px rgba(0, 255, 255, 0.8);
            font-weight: 600;
            line-height: 1.1;
        }

        .menu-tagline {
            font-size: clamp(9px, 1.8vw, 12px);
            color: rgba(255, 255, 255, 0.5);
            font-family: 'Rajdhani', sans-serif;
            font-weight: 600;
            letter-spacing: clamp(0.5px, 0.2vw, 1px);
            line-height: 1.1;
        }

        /* Login Container Wrapper */
        .login-container-wrapper {
            width: 100%;
            max-width: 420px;
            display: flex;
            justify-content: center;
            flex-shrink: 1;
            min-height: 0;
        }

        /* Login Card */
        .login-card {
            background: linear-gradient(135deg, rgba(26, 0, 51, 0.8) 0%, rgba(10, 10, 40, 0.8) 100%);
            border: 1px solid;
            border-image: linear-gradient(135deg, rgba(255, 0, 255, 0.5), rgba(0, 255, 255, 0.5)) 1;
            border-radius: 16px;
            padding: clamp(16px, 2.8vh, 24px) clamp(16px, 3vw, 24px);
            backdrop-filter: blur(20px);
            box-shadow:
                0 6px 24px rgba(0, 0, 0, 0.4),
                inset 0 0 30px rgba(255, 0, 255, 0.05),
                0 0 40px rgba(255, 0, 255, 0.2);
            display: flex;
            flex-direction: column;
            gap: clamp(10px, 1.8vh, 15px);
            width: 100%;
        }

        .login-card-title {
            font-size: clamp(16px, 3.5vw, 20px);
            font-weight: 700;
            text-align: center;
            background: linear-gradient(90deg, #ff00ff, #00ffff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: 0.5px;
            line-height: 1.2;
        }

        /* Google Sign-In Button */
        .google-signin-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            background: #ffffff;
            color: #3c4043;
            border: none;
            padding: clamp(11px, 2.2vh, 14px) clamp(16px, 3.5vw, 22px);
            font-size: clamp(13px, 2.6vw, 15px);
            font-weight: 600;
            font-family: 'Roboto', 'Orbitron', sans-serif;
            border-radius: 10px;
            cursor: pointer;
            box-shadow:
                0 3px 10px rgba(0, 0, 0, 0.15),
                0 0 30px rgba(66, 133, 244, 0.4);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            width: 100%;
        }        .google-signin-btn:hover {
            box-shadow:
                0 6px 20px rgba(0, 0, 0, 0.25),
                0 0 60px rgba(66, 133, 244, 0.6);
            transform: translateY(-2px);
        }

        .google-signin-btn:active {
            transform: translateY(0);
        }

        .google-icon {
            width: clamp(18px, 3.5vw, 20px);
            height: clamp(18px, 3.5vw, 20px);
            flex-shrink: 0;
        }

        /* Login Divider */
        .login-divider {
            display: flex;
            align-items: center;
            gap: 8px;
            margin: clamp(2px, 0.8vh, 5px) 0;
        }

        .divider-line {
            flex: 1;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
        }

        .divider-text {
            color: rgba(255, 255, 255, 0.4);
            font-size: clamp(10px, 2vw, 12px);
            font-weight: 600;
            font-family: 'Rajdhani', sans-serif;
            letter-spacing: 0.5px;
        }

        /* Guest Button */
        .guest-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.2) 0%, rgba(118, 75, 162, 0.2) 100%);
            color: #fff;
            border: 2px solid;
            border-image: linear-gradient(135deg, #667eea, #764ba2) 1;
            border-radius: 10px;
            padding: clamp(11px, 2.2vh, 14px) clamp(16px, 3.5vw, 22px);
            font-size: clamp(13px, 2.6vw, 15px);
            font-weight: 700;
            font-family: 'Orbitron', sans-serif;
            cursor: pointer;
            box-shadow:
                0 3px 10px rgba(0, 0, 0, 0.15),
                inset 0 0 15px rgba(102, 126, 234, 0.1),
                0 0 30px rgba(102, 126, 234, 0.3);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            width: 100%;
        }

        .guest-btn:hover {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.3) 0%, rgba(118, 75, 162, 0.3) 100%);
            box-shadow:
                0 6px 20px rgba(0, 0, 0, 0.25),
                inset 0 0 30px rgba(102, 126, 234, 0.2),
                0 0 60px rgba(102, 126, 234, 0.5);
            transform: translateY(-2px);
        }

        .guest-btn:active {
            transform: translateY(0);
        }

        .guest-icon {
            width: clamp(18px, 3.5vw, 20px);
            height: clamp(18px, 3.5vw, 20px);
            flex-shrink: 0;
        }

        .btn-text {
            white-space: nowrap;
        }

        /* Login Benefits */
        .login-benefits {
            display: flex;
            justify-content: space-around;
            gap: clamp(8px, 1.5vw, 12px);
            margin-top: clamp(4px, 1vh, 8px);
            padding-top: clamp(8px, 1.5vh, 12px);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .benefit-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            flex: 1;
        }

        .benefit-icon {
            font-size: clamp(16px, 3.5vw, 20px);
            filter: drop-shadow(0 0 8px rgba(0, 255, 255, 0.5));
        }

        .benefit-text {
            font-size: clamp(9px, 1.8vw, 11px);
            color: rgba(255, 255, 255, 0.6);
            text-align: center;
            font-family: 'Rajdhani', sans-serif;
            font-weight: 600;
            letter-spacing: 0.3px;
            line-height: 1.1;
        }

        /* User Menu Wrapper */
        .user-menu-wrapper {
            width: 100%;
            max-width: 900px;
            display: flex;
            flex-direction: column;
            gap: clamp(12px, 2.2vh, 20px);
            flex-shrink: 1;
            min-height: 0;
        }

        /* User Profile Card */
        .user-profile-card {
            background: linear-gradient(135deg, rgba(26, 0, 51, 0.6) 0%, rgba(10, 10, 40, 0.6) 100%);
            border: 1px solid;
            border-image: linear-gradient(135deg, rgba(0, 255, 255, 0.5), rgba(255, 0, 255, 0.5)) 1;
            border-radius: 14px;
            padding: clamp(14px, 2.5vh, 20px) clamp(16px, 3vw, 22px);
            backdrop-filter: blur(20px);
            box-shadow:
                0 6px 24px rgba(0, 0, 0, 0.3),
                inset 0 0 30px rgba(0, 255, 255, 0.05),
                0 0 30px rgba(0, 255, 255, 0.2);
            flex-shrink: 0;
            margin-bottom: 1rem;
        }

        .profile-header {
            display: flex;
            align-items: center;
            gap: clamp(12px, 2.5vw, 18px);
        }

        .user-avatar {
            width: clamp(48px, 10vw, 64px);
            height: clamp(48px, 10vw, 64px);
            border-radius: 50%;
            border: 2px solid #00ffff;
            box-shadow:
                0 0 20px rgba(0, 255, 255, 0.6),
                inset 0 0 15px rgba(0, 255, 255, 0.1);
            flex-shrink: 0;
        }

        .profile-info {
            display: flex;
            flex-direction: column;
            gap: 5px;
            flex: 1;
            min-width: 0;
        }

        .user-name {
            font-size: clamp(16px, 3.8vw, 22px);
            color: #fff;
            font-weight: 700;
            text-shadow: 0 0 15px rgba(255, 0, 255, 0.6);
            letter-spacing: 0.5px;
            text-transform: uppercase;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            line-height: 1.1;
        }

        .guest-badge {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            background: linear-gradient(135deg, rgba(255, 165, 0, 0.2), rgba(255, 140, 0, 0.2));
            border: 1px solid rgba(255, 165, 0, 0.5);
            color: #ffa500;
            padding: 4px 10px;
            border-radius: 16px;
            font-size: clamp(9px, 1.8vw, 11px);
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            box-shadow: 0 0 12px rgba(255, 165, 0, 0.3);
            width: fit-content;
        }        .guest-badge svg {
            animation: pulse-dot 2s ease-in-out infinite;
        }

        @keyframes pulse-dot {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.4; }
        }

        /* User Best Score */
        .user-best-score {
            display: flex;
            align-items: center;
            gap: 8px;
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.15), rgba(255, 165, 0, 0.15));
            border: 1px solid rgba(255, 215, 0, 0.4);
            padding: 6px 12px;
            border-radius: 12px;
            margin-top: 4px;
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.2);
            width: fit-content;
        }

        .best-score-label {
            font-size: clamp(10px, 2vw, 12px);
            color: rgba(255, 215, 0, 0.9);
            font-weight: 600;
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }

        #bestScoreValue {
            font-size: clamp(14px, 3vw, 18px);
            color: #ffd700;
            font-weight: 900;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.6);
            letter-spacing: 0.5px;
        }

        /* Action Grid */
        .action-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: clamp(8px, 1.5vh, 12px);
            width: 100%;
            flex-shrink: 1;
            min-height: 0;
        }

        @media (min-width: 600px) {
            .action-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* Action Cards */
        .action-card {
            background: linear-gradient(135deg, rgba(26, 0, 51, 0.5) 0%, rgba(10, 10, 40, 0.5) 100%);
            border: 1px solid rgba(255, 0, 255, 0.3);
            border-radius: 12px;

            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            gap: clamp(10px, 2vw, 14px);
            backdrop-filter: blur(10px);
            box-shadow:
                0 3px 10px rgba(0, 0, 0, 0.2),
                inset 0 0 15px rgba(255, 0, 255, 0.05);
            font-family: 'Orbitron', sans-serif;
            color: #fff;
            text-align: left;
        }        .action-card:hover {
            transform: translateY(-4px);
            border-color: rgba(0, 255, 255, 0.6);
            box-shadow:
                0 8px 24px rgba(0, 0, 0, 0.3),
                inset 0 0 30px rgba(0, 255, 255, 0.1),
                0 0 40px rgba(0, 255, 255, 0.4);
        }

        .action-card:active {
            transform: translateY(-2px);
        }

        /* Primary Action (START GAME) */
        .primary-action {
            grid-column: 1 / -1;
            background: linear-gradient(135deg, rgba(0, 255, 0, 0.15) 0%, rgba(0, 255, 255, 0.15) 100%);
            border-color: rgba(0, 255, 255, 0.5);
            box-shadow:
                0 4px 16px rgba(0, 0, 0, 0.25),
                inset 0 0 20px rgba(0, 255, 255, 0.1),
                0 0 35px rgba(0, 255, 255, 0.3);
        }

        .primary-action:hover {
            border-color: rgba(0, 255, 0, 0.8);
            box-shadow:
                0 6px 20px rgba(0, 0, 0, 0.35),
                inset 0 0 30px rgba(0, 255, 0, 0.15),
                0 0 45px rgba(0, 255, 0, 0.5);
        }

        .action-icon {
            width: clamp(40px, 8vw, 52px);
            height: clamp(40px, 8vw, 52px);
            min-width: clamp(40px, 8vw, 52px);
            background: linear-gradient(135deg, rgba(0, 255, 255, 0.2), rgba(0, 255, 0, 0.2));
            border: 2px solid rgba(0, 255, 255, 0.5);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.4);
        }

        .action-icon svg {
            width: 60%;
            height: 60%;
            stroke: #00ffff;
            filter: drop-shadow(0 0 8px rgba(0, 255, 255, 0.8));
        }

        .action-icon-small {
            width: clamp(34px, 7vw, 42px);
            height: clamp(34px, 7vw, 42px);
            min-width: clamp(34px, 7vw, 42px);
            background: linear-gradient(135deg, rgba(255, 0, 255, 0.15), rgba(138, 0, 230, 0.15));
            border: 1px solid rgba(255, 0, 255, 0.4);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 0 12px rgba(255, 0, 255, 0.3);
        }

        .action-icon-small svg {
            width: 55%;
            height: 55%;
            stroke: #ff00ff;
            filter: drop-shadow(0 0 6px rgba(255, 0, 255, 0.6));
        }

        .action-content {
            display: flex;
            flex-direction: column;
            gap: 3px;
            flex: 1;
            min-width: 0;
        }

        .action-title {
            font-size: clamp(12px, 2.6vw, 15px);
            font-weight: 700;
            color: #fff;
            letter-spacing: 0.5px;
            text-transform: uppercase;
            line-height: 1.1;
        }

        .action-subtitle {
            font-size: clamp(9px, 1.9vw, 11px);
            color: rgba(255, 255, 255, 0.6);
            font-family: 'Rajdhani', sans-serif;
            font-weight: 600;
            line-height: 1.1;
        }        /* Login Action (for guests) */
        .login-action {
            border-color: rgba(255, 165, 0, 0.4);
            background: linear-gradient(135deg, rgba(255, 165, 0, 0.1), rgba(255, 140, 0, 0.1));
        }

        .login-action:hover {
            border-color: rgba(255, 165, 0, 0.7);
            box-shadow:
                0 8px 24px rgba(0, 0, 0, 0.3),
                inset 0 0 30px rgba(255, 165, 0, 0.1),
                0 0 40px rgba(255, 165, 0, 0.4);
        }

        .login-action .action-icon-small {
            background: linear-gradient(135deg, rgba(255, 165, 0, 0.2), rgba(255, 140, 0, 0.2));
            border-color: rgba(255, 165, 0, 0.5);
            box-shadow: 0 0 15px rgba(255, 165, 0, 0.3);
        }

        .login-action .action-icon-small svg {
            stroke: #ffa500;
            filter: drop-shadow(0 0 8px rgba(255, 165, 0, 0.6));
        }

        /* =========================
           LEVEL SELECTOR MODAL
        ========================= */
        .level-selector {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 50% 50%, #1a0033 0%, #000000 100%);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 10001;
            padding: clamp(20px, 3vh, 30px) clamp(15px, 3vw, 25px);
            overflow: hidden;
        }

        .level-selector.active {
            display: flex;
            flex-direction: column;
        }

        .level-selector-title {
            font-size: clamp(24px, 5vw, 38px);
            font-weight: 900;
            background: linear-gradient(135deg, #ff00ff, #00ffff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            margin-bottom: clamp(18px, 3vh, 28px);
            text-align: center;
            text-shadow: 0 0 30px rgba(255, 0, 255, 0.5);
        }

        .level-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(clamp(65px, 12vw, 85px), 1fr));
            gap: clamp(8px, 1.5vw, 14px);
            max-width: min(92vw, 600px);
            max-height: calc(100vh - clamp(140px, 20vh, 180px));
            width: 100%;
            padding: clamp(18px, 3.5vh, 30px) clamp(16px, 3vw, 26px);
            background: linear-gradient(135deg, rgba(26, 0, 51, 0.7) 0%, rgba(10, 10, 40, 0.7) 100%);
            border-radius: 18px;
            border: 2px solid;
            border-image: linear-gradient(135deg, rgba(255, 0, 255, 0.6), rgba(0, 255, 255, 0.6)) 1;
            box-shadow:
                0 8px 32px rgba(0, 0, 0, 0.4),
                inset 0 0 40px rgba(255, 0, 255, 0.08),
                0 0 50px rgba(255, 0, 255, 0.3);
            overflow-y: auto;
            overflow-x: hidden;
            backdrop-filter: blur(20px);
        }

        @media (min-width: 768px) {
            .level-grid {
                grid-template-columns: repeat(auto-fit, minmax(clamp(85px, 14vw, 105px), 1fr));
            }
        }

        .level-btn {
            background: linear-gradient(135deg, rgba(26, 0, 51, 0.8), rgba(51, 0, 102, 0.8));
            border: 2px solid #ff00ff;
            padding: clamp(12px, 2.5vw, 18px);
            font-size: clamp(15px, 3vw, 20px);
            font-weight: 900;
            color: #fff;
            cursor: pointer;
            border-radius: 14px;
            font-family: 'Orbitron', sans-serif;
            box-shadow:
                0 4px 15px rgba(255, 0, 255, 0.3),
                inset 0 0 20px rgba(255, 0, 255, 0.1);
            transition: all 0.3s ease;
            text-transform: uppercase;
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(10px);
        }

        .level-btn::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 0, 255, 0.3), transparent);
            transform: rotate(45deg);
            transition: all 0.5s ease;
        }

        .level-btn:hover::before {
            left: 100%;
        }

        .level-btn:hover {
            transform: scale(1.08) translateY(-2px);
            box-shadow:
                0 0 30px rgba(0, 255, 255, 0.6),
                0 8px 20px rgba(255, 0, 255, 0.4),
                inset 0 0 25px rgba(0, 255, 255, 0.15);
            border-color: #00ffff;
            background: linear-gradient(135deg, rgba(0, 255, 255, 0.2), rgba(255, 0, 255, 0.2));
        }

        .level-btn.locked {
            opacity: 0.25;
            cursor: not-allowed;
            filter: grayscale(0.8);
        }

        .level-btn.locked:hover {
            transform: none;
            box-shadow: 0 4px 15px rgba(255, 0, 255, 0.2);
            border-color: #ff00ff;
            background: linear-gradient(135deg, rgba(26, 0, 51, 0.8), rgba(51, 0, 102, 0.8));
        }

        .close-level-selector {
            position: absolute;
            top: clamp(12px, 2.5vw, 22px);
            right: clamp(12px, 2.5vw, 22px);
            background: linear-gradient(135deg, rgba(255, 0, 0, 0.9), rgba(200, 0, 0, 0.9));
            border: 2px solid rgba(255, 0, 0, 0.6);
            color: #fff;
            font-size: clamp(24px, 5vw, 34px);
            width: clamp(42px, 8.5vw, 54px);
            height: clamp(42px, 8.5vw, 54px);
            border-radius: 50%;
            cursor: pointer;
            font-weight: 900;
            box-shadow:
                0 4px 20px rgba(255, 0, 0, 0.5),
                inset 0 0 15px rgba(255, 0, 0, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10002;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .close-level-selector:hover {
            background: linear-gradient(135deg, rgba(255, 0, 0, 1), rgba(255, 50, 50, 1));
            transform: scale(1.12) rotate(90deg);
            box-shadow: 0 0 35px rgba(255, 0, 0, 0.8);
        }

        /* Stats & Ranking Page */
        .stats-page {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 50% 50%, #0a0033 0%, #000000 100%);
            display: none;
            flex-direction: column;
            z-index: 10001;
            overflow-y: auto;
            overflow-x: hidden;
            padding: clamp(20px, 3vh, 30px) clamp(15px, 3vw, 25px);
        }

        .stats-page.active {
            display: flex;
        }

        .stats-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: clamp(14px, 2.5vh, 22px);
            flex-wrap: nowrap;
            gap: 12px;
            flex-shrink: 0;
        }

        .stats-title {
            font-size: clamp(22px, 5vw, 36px);
            font-weight: 900;
            background: linear-gradient(135deg, #00ffff, #ff00ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-transform: uppercase;
            letter-spacing: 1.2px;
            line-height: 1.1;
        }

        .close-stats-btn {
            background: linear-gradient(135deg, rgba(255, 0, 0, 0.9), rgba(200, 0, 0, 0.9));
            border: 2px solid rgba(255, 0, 0, 0.6);
            color: #fff;
            font-size: clamp(20px, 4vw, 28px);
            width: clamp(38px, 7.5vw, 48px);
            height: clamp(38px, 7.5vw, 48px);
            border-radius: 50%;
            cursor: pointer;
            font-weight: 900;
            flex-shrink: 0;
            box-shadow:
                0 4px 20px rgba(255, 0, 0, 0.5),
                inset 0 0 15px rgba(255, 0, 0, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .close-stats-btn:hover {
            background: linear-gradient(135deg, rgba(255, 0, 0, 1), rgba(255, 50, 50, 1));
            transform: scale(1.12) rotate(90deg);
            box-shadow: 0 0 35px rgba(255, 0, 0, 0.8);
        }

        .stats-tabs {
            display: flex;
            gap: clamp(6px, 1.5vw, 10px);
            margin-bottom: clamp(14px, 2.5vh, 22px);
            flex-shrink: 0;
            flex-wrap: wrap;
        }

        .tab-btn {
            flex: 1;
            min-width: clamp(70px, 18vw, 100px);
            background: linear-gradient(135deg, rgba(26, 0, 51, 0.6), rgba(10, 10, 40, 0.6));
            border: 2px solid rgba(0, 255, 255, 0.3);
            color: rgba(255, 255, 255, 0.7);
            padding: clamp(8px, 1.8vh, 12px) clamp(10px, 2.5vw, 14px);
            font-size: clamp(11px, 2.3vw, 14px);
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }

        .tab-btn:hover {
            border-color: rgba(0, 255, 255, 0.6);
            color: #00ffff;
            transform: translateY(-2px);
        }

        .tab-btn.active {
            background: linear-gradient(135deg, rgba(0, 255, 255, 0.25), rgba(255, 0, 255, 0.25));
            border-color: #00ffff;
            color: #00ffff;
            box-shadow:
                0 0 20px rgba(0, 255, 255, 0.4),
                inset 0 0 15px rgba(0, 255, 255, 0.1);
        }

        .stats-content {
            display: none;
            flex-direction: column;
            gap: clamp(14px, 2.5vh, 22px);
            flex: 1;
            overflow-y: auto;
            padding-right: 6px;
        }

        .stats-content.active {
            display: flex;
        }

        .ranking-section {
            background: linear-gradient(135deg, rgba(26, 0, 51, 0.5) 0%, rgba(10, 10, 40, 0.5) 100%);
            border: 1px solid;
            border-image: linear-gradient(135deg, rgba(0, 255, 255, 0.4), rgba(255, 0, 255, 0.4)) 1;
            border-radius: 14px;
            padding: clamp(14px, 2.5vh, 20px) clamp(12px, 2.5vw, 18px);
            backdrop-filter: blur(15px);
            box-shadow:
                0 4px 20px rgba(0, 0, 0, 0.3),
                inset 0 0 25px rgba(0, 255, 255, 0.05);
        }

        .section-title {
            font-size: clamp(15px, 3.2vw, 20px);
            font-weight: 700;
            color: #fff;
            margin-bottom: clamp(10px, 2vh, 14px);
            text-transform: uppercase;
            letter-spacing: 0.8px;
            text-shadow: 0 0 12px rgba(0, 255, 255, 0.5);
        }

        .my-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(clamp(65px, 18vw, 90px), 1fr));
            gap: clamp(8px, 1.8vw, 12px);
            margin-bottom: clamp(10px, 2vh, 14px);
        }

        .stat-box {
            background: linear-gradient(135deg, rgba(0, 255, 255, 0.1), rgba(255, 0, 255, 0.1));
            border: 1px solid rgba(0, 255, 255, 0.3);
            border-radius: 10px;
            padding: clamp(10px, 2vh, 14px) clamp(8px, 1.8vw, 12px);
            text-align: center;
            box-shadow:
                0 2px 10px rgba(0, 0, 0, 0.2),
                inset 0 0 15px rgba(0, 255, 255, 0.05);
        }

        .stat-box-value {
            font-size: clamp(16px, 3.5vw, 24px);
            font-weight: 900;
            color: #00ffff;
            text-shadow: 0 0 10px rgba(0, 255, 255, 0.6);
            margin-bottom: 4px;
        }

        .stat-box-label {
            font-size: clamp(9px, 1.8vw, 11px);
            color: rgba(255, 255, 255, 0.6);
            text-transform: uppercase;
            letter-spacing: 0.3px;
            font-weight: 600;
        }

        .loading-stats {
            font-size: clamp(12px, 2.5vw, 15px);
            color: rgba(255, 255, 255, 0.5);
            text-align: center;
            padding: clamp(16px, 3vh, 24px);
            font-style: italic;
        }

        .ranking-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0 clamp(4px, 1vh, 8px);
        }

        .ranking-table thead th {
            background: linear-gradient(135deg, rgba(0, 255, 255, 0.2), rgba(255, 0, 255, 0.2));
            color: #00ffff;
            padding: clamp(8px, 1.8vh, 12px) clamp(6px, 1.5vw, 10px);
            text-align: left;
            font-size: clamp(10px, 2vw, 13px);
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border: 1px solid rgba(0, 255, 255, 0.3);
        }

        .ranking-table thead th:first-child {
            border-radius: 8px 0 0 8px;
        }

        .ranking-table thead th:last-child {
            border-radius: 0 8px 8px 0;
        }

        .ranking-table tbody tr {
            background: rgba(20, 20, 50, 0.4);
            transition: all 0.2s ease;
        }

        .ranking-table tbody tr:hover {
            background: rgba(0, 255, 255, 0.1);
            transform: translateX(4px);
        }

        .ranking-table tbody td {
            padding: clamp(8px, 1.8vh, 12px) clamp(6px, 1.5vw, 10px);
            font-size: clamp(11px, 2.2vw, 14px);
            color: rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .ranking-table tbody td:first-child {
            border-radius: 6px 0 0 6px;
            font-weight: 900;
            color: #ff00ff;
            text-shadow: 0 0 8px rgba(255, 0, 255, 0.5);
        }

        .ranking-table tbody td:last-child {
            border-radius: 0 6px 6px 0;
           background: linear-gradient(135deg, #00ffff, #ff00ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-transform: uppercase;
            letter-spacing: 1px;
            line-height: 1.1;
        }

        .close-stats-btn {
            background: rgba(255, 0, 0, 0.8);
            border: none;
            color: #fff;
            font-size: clamp(18px, 3.5vw, 24px);
            width: clamp(36px, 7vw, 44px);
            height: clamp(36px, 7vw, 44px);
            border-radius: 50%;
            cursor: pointer;
            font-weight: 900;
            flex-shrink: 0;
            box-shadow: 0 0 30px rgba(255, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-stats-btn:hover {
            background: rgba(255, 0, 0, 1);
            transform: scale(1.1);
        }

        /* ===========================
           SETTINGS MENU - REDESIGNED
        =========================== */
        .settings-menu {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 50% 50%, #1a000a 0%, #000000 100%);
            z-index: 10002;
            overflow-y: auto;
            overflow-x: hidden;
            padding: 0;
            display: none;
        }

        .settings-menu.active {
            display: block;
        }

        .settings-container {
            max-width: 800px;
            margin: 0 auto;
            padding: clamp(12px, 2vh, 18px) clamp(12px, 2.5vw, 18px);
            padding-bottom: clamp(20px, 3vh, 30px);
        }

        .settings-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: clamp(12px, 2vh, 18px);
            position: sticky;
            top: 0;
            background: linear-gradient(180deg, #000000 0%, rgba(0,0,0,0.95) 80%, transparent 100%);
            z-index: 10;
            padding: clamp(10px, 1.5vh, 15px) 0;
        }

        .settings-title {
            font-size: clamp(20px, 4.5vw, 32px);
            font-weight: 900;
            background: linear-gradient(135deg, #00ffff, #ff00ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-transform: uppercase;
            letter-spacing: 2px;
            text-shadow: 0 0 30px rgba(0, 255, 255, 0.5);
        }

        .close-settings-btn {
            background: transparent;
            border: none;
            color: rgba(255, 255, 255, 0.6);
            width: clamp(32px, 7vw, 42px);
            height: clamp(32px, 7vw, 42px);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            flex-shrink: 0;
        }

        .close-settings-btn svg {
            width: clamp(20px, 4.5vw, 28px);
            height: clamp(20px, 4.5vw, 28px);
        }

        .close-settings-btn:hover {
            color: #ff0055;
            transform: scale(1.15) rotate(90deg);
        }

        .close-settings-btn:active {
            transform: scale(0.95) rotate(90deg);
        }

        .settings-content {
            display: flex;
            flex-direction: column;
            gap: clamp(12px, 2.5vh, 18px);
        }

        /* Setting Categories */
        .settings-category {
            margin-bottom: clamp(6px, 1vh, 8px);
        }

        .category-title {
            font-size: clamp(12px, 2.6vw, 16px);
            font-weight: 700;
            color: #00ffff;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            margin-bottom: clamp(8px, 1.5vh, 12px);
            padding-left: clamp(6px, 1.2vw, 10px);
            border-left: 3px solid #00ffff;
            text-shadow: 0 0 15px rgba(0, 255, 255, 0.6);
        }

        /* Setting Sections */
        .setting-section {
            background: linear-gradient(135deg, rgba(26, 0, 51, 0.4) 0%, rgba(10, 10, 40, 0.4) 100%);
            border: 1px solid rgba(255, 0, 255, 0.25);
            border-radius: 10px;
            padding: clamp(10px, 2vh, 14px) clamp(12px, 2.5vw, 16px);
            backdrop-filter: blur(12px);
            box-shadow:
                0 4px 16px rgba(0, 0, 0, 0.25),
                inset 0 0 20px rgba(255, 0, 255, 0.03);
            transition: all 0.3s ease;
        }

        .setting-section:hover {
            border-color: rgba(255, 0, 255, 0.4);
            box-shadow:
                0 6px 20px rgba(0, 0, 0, 0.3),
                inset 0 0 25px rgba(255, 0, 255, 0.05);
        }

        .setting-label {
            font-size: clamp(13px, 2.8vw, 16px);
            font-weight: 700;
            color: #fff;
            margin-bottom: clamp(5px, 1vh, 8px);
            text-transform: uppercase;
            letter-spacing: 0.8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .setting-label .emoji {
            font-size: clamp(15px, 3.2vw, 20px);
        }

        .setting-description {
            font-size: clamp(10px, 2vw, 12px);
            color: rgba(255, 255, 255, 0.55);
            margin-bottom: clamp(10px, 2vh, 14px);
            line-height: 1.3;
        }

        /* Slider Controls */
        .slider-container {
            display: flex;
            flex-direction: column;
            gap: clamp(6px, 1.2vh, 10px);
        }

        .slider-row {
            display: flex;
            align-items: center;
            gap: clamp(8px, 2vw, 12px);
        }

        .slider-label {
            font-size: clamp(11px, 2.2vw, 13px);
            color: rgba(255, 255, 255, 0.8);
            min-width: clamp(70px, 16vw, 100px);
            font-weight: 600;
        }

        .slider-wrapper {
            flex: 1;
            display: flex;
            align-items: center;
            gap: clamp(8px, 1.8vw, 12px);
        }

        .slider {
            -webkit-appearance: none;
            appearance: none;
            flex: 1;
            height: clamp(5px, 1vh, 6px);
            background: linear-gradient(90deg, rgba(255, 0, 255, 0.2), rgba(0, 255, 255, 0.2));
            border-radius: 10px;
            outline: none;
            border: 1px solid rgba(255, 0, 255, 0.3);
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: clamp(16px, 3.4vw, 20px);
            height: clamp(16px, 3.4vw, 20px);
            background: linear-gradient(135deg, #ff00ff, #00ffff);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 0 15px rgba(255, 0, 255, 0.8);
            transition: all 0.2s ease;
        }

        .slider::-webkit-slider-thumb:hover {
            transform: scale(1.2);
            box-shadow: 0 0 25px rgba(255, 0, 255, 1);
        }

        .slider::-moz-range-thumb {
            width: clamp(16px, 3.4vw, 20px);
            height: clamp(16px, 3.4vw, 20px);
            background: linear-gradient(135deg, #ff00ff, #00ffff);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 0 15px rgba(255, 0, 255, 0.8);
            border: none;
            transition: all 0.2s ease;
        }

        .slider::-moz-range-thumb:hover {
            transform: scale(1.2);
            box-shadow: 0 0 25px rgba(255, 0, 255, 1);
        }

        .slider-value {
            font-size: clamp(12px, 2.5vw, 14px);
            font-weight: 700;
            color: #00ffff;
            min-width: clamp(35px, 7vw, 45px);
            text-align: right;
            text-shadow: 0 0 10px rgba(0, 255, 255, 0.6);
        }

        /* Toggle Switch */
        .toggle-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: clamp(10px, 2vw, 14px);
        }

        .toggle-label {
            font-size: clamp(12px, 2.5vw, 14px);
            color: rgba(255, 255, 255, 0.85);
            font-weight: 600;
        }

        .toggle-switch {
            position: relative;
            width: clamp(44px, 10vw, 56px);
            height: clamp(22px, 4.8vh, 28px);
            background: rgba(100, 100, 100, 0.3);
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        .toggle-switch.active {
            background: linear-gradient(135deg, rgba(255, 0, 255, 0.4), rgba(0, 255, 255, 0.4));
            border-color: #00ffff;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.5);
        }

        .toggle-slider {
            position: absolute;
            top: 2px;
            left: 2px;
            width: clamp(16px, 4vw, 22px);
            height: clamp(16px, 4vw, 22px);
            background: linear-gradient(135deg, #666, #888);
            border-radius: 50%;
            transition: all 0.3s ease;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
        }

        .toggle-switch.active .toggle-slider {
            transform: translateX(clamp(20px, 5vw, 28px));
            background: linear-gradient(135deg, #00ffff, #ff00ff);
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.8);
        }

        /* Radio Options (for difficulty, size, etc) */
        .control-options {
            display: flex;
            flex-direction: column;
            gap: clamp(6px, 1.5vh, 10px);
        }

        .control-option {
            position: relative;
        }

        .control-option input[type="radio"] {
            position: absolute;
            opacity: 0;
            width: 0;
            height: 0;
        }

        .control-option label {
            display: flex;
            align-items: center;
            gap: clamp(8px, 1.8vw, 12px);
            background: rgba(20, 20, 50, 0.5);
            border: 2px solid rgba(255, 0, 255, 0.25);
            border-radius: 8px;
            padding: clamp(8px, 1.6vh, 11px) clamp(10px, 2vw, 14px);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .control-option input[type="radio"]:checked + label {
            background: linear-gradient(135deg, rgba(255, 0, 255, 0.2), rgba(0, 255, 255, 0.2));
            border-color: #00ffff;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.4), inset 0 0 15px rgba(255, 0, 255, 0.1);
        }

        .control-option label:hover {
            border-color: rgba(0, 255, 255, 0.5);
            transform: translateX(3px);
        }

        .option-icon {
            font-size: clamp(16px, 4vw, 22px);
            flex-shrink: 0;
        }

        .option-content {
            display: flex;
            flex-direction: column;
            gap: 2px;
            flex: 1;
        }

        .option-title {
            font-size: clamp(12px, 2.5vw, 14px);
            font-weight: 700;
            color: #fff;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .option-desc {
            font-size: clamp(9px, 1.9vw, 11px);
            color: rgba(255, 255, 255, 0.55);
            line-height: 1.2;
        }

        /* Logout Button */
        .logout-btn {
            background: linear-gradient(135deg, rgba(255, 0, 0, 0.2), rgba(200, 0, 0, 0.2));
            border: 2px solid rgba(255, 0, 0, 0.5);
            color: #ff4444;
            padding: clamp(10px, 2vh, 14px) clamp(16px, 3vw, 20px);
            border-radius: 10px;
            font-size: clamp(13px, 2.7vw, 16px);
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            box-shadow: 0 4px 15px rgba(255, 0, 0, 0.2);
            width: 100%;
        }

        .logout-btn:hover {
            background: linear-gradient(135deg, rgba(255, 0, 0, 0.4), rgba(200, 0, 0, 0.4));
            border-color: #ff0000;
            box-shadow: 0 0 25px rgba(255, 0, 0, 0.6);
            transform: translateY(-2px);
        }

        .logout-btn svg {
            width: clamp(16px, 3.2vw, 20px);
            height: clamp(16px, 3.2vw, 20px);
        }

        .control-option {
            position: relative;
        }

        .control-option input[type="radio"] {
            position: absolute;
            opacity: 0;
        }

        .control-option label {
            display: block;
            background: rgba(0, 0, 0, 0.5);
            border: 3px solid rgba(255, 0, 255, 0.3);
            border-radius: 15px;
            padding: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .control-option input[type="radio"]:checked + label {
            background: rgba(255, 0, 255, 0.2);
            border-color: #ff00ff;
            box-shadow: 0 0 30px rgba(255, 0, 255, 0.5);
        }

        .control-option label:hover {
            transform: translateY(-5px);
            border-color: #00ffff;
        }

        .option-icon {
            font-size: clamp(40px, 8vw, 60px);
            margin-bottom: 15px;
        }

        .option-title {
            font-size: clamp(16px, 3vw, 20px);
            font-weight: 900;
            color: #00ffff;
            text-shadow: 0 0 15px #00ffff;
            margin-bottom: 10px;
            text-transform: uppercase;
        }

        .option-desc {
            font-size: clamp(12px, 2.2vw, 14px);
            color: rgba(255, 255, 255, 0.6);
            line-height: 1.4;
        }

        .stats-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: nowrap;
            justify-content: center;
            overflow-x: auto;
        }

        .tab-btn {
            background: rgba(255, 0, 255, 0.2);
            border: 2px solid #ff00ff;
            color: #fff;
            padding: clamp(10px, 2vw, 15px) clamp(20px, 4vw, 30px);
            font-size: clamp(12px, 2.5vw, 16px);
            font-weight: 700;
            cursor: pointer;
            border-radius: 25px;
            font-family: 'Orbitron', sans-serif;
            transition: all 0.3s ease;
            text-transform: uppercase;
        }

        .tab-btn.active {
            background: linear-gradient(135deg, #ff00ff, #00ffff);
            color: #000;
            box-shadow: 0 0 30px rgba(255, 0, 255, 0.8);
        }

        .tab-btn:hover {
            transform: scale(1.05);
        }

        .stats-content {
            display: none;
        }

        .stats-content.active {
            display: block;
        }

        .ranking-section {
            background: rgba(20, 0, 40, 0.6);
            border: 2px solid rgba(255, 0, 255, 0.4);
            border-radius: 15px;
            padding: clamp(15px, 3vw, 25px);
            margin-bottom: 25px;
            box-shadow: 0 0 30px rgba(255, 0, 255, 0.3);
        }

        .section-title {
            font-size: clamp(18px, 3.5vw, 24px);
            color: #00ffff;
            text-transform: uppercase;
            margin-bottom: 20px;
            text-shadow: 0 0 20px #00ffff;
            font-weight: 700;
        }

        .ranking-table {
            width: 100%;
            border-collapse: collapse;
        }

        .ranking-table th {
            background: rgba(255, 0, 255, 0.3);
            color: #fff;
            padding: clamp(8px, 2vw, 12px);
            text-align: left;
            font-size: clamp(12px, 2vw, 14px);
            text-transform: uppercase;
            border-bottom: 2px solid #ff00ff;
        }

        .ranking-table td {
            padding: clamp(8px, 2vw, 12px);
            color: #fff;
            font-size: clamp(11px, 1.8vw, 14px);
            border-bottom: 1px solid rgba(255, 0, 255, 0.2);
        }

        .ranking-table tr:hover {
            background: rgba(0, 255, 255, 0.1);
        }

        .ranking-table tr.current-user {
            background: rgba(255, 215, 0, 0.2);
            border: 2px solid #ffd700;
        }

        .rank-number {
            font-weight: 900;
            color: #00ffff;
            font-size: clamp(14px, 2.5vw, 18px);
        }

        .rank-gold {
            color: #ffd700;
        }

        .rank-silver {
            color: #c0c0c0;
        }

        .rank-bronze {
            color: #cd7f32;
        }

        .my-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .stat-box {
            background: linear-gradient(135deg, rgba(255, 0, 255, 0.2), rgba(0, 255, 255, 0.2));
            border: 2px solid rgba(255, 0, 255, 0.5);
            border-radius: 15px;
            padding: clamp(15px, 3vw, 20px);
            text-align: center;
        }

        .stat-box-value {
            font-size: clamp(24px, 5vw, 36px);
            font-weight: 900;
            color: #00ffff;
            text-shadow: 0 0 20px #00ffff;
        }

        .stat-box-label {
            font-size: clamp(10px, 2vw, 12px);
            color: rgba(255, 255, 255, 0.7);
            text-transform: uppercase;
            margin-top: 8px;
        }

        .loading-stats {
            text-align: center;
            color: #00ffff;
            font-size: clamp(16px, 3vw, 20px);
            padding: 40px;
        }

        @media (max-width: 768px) {
            .ranking-table th:nth-child(4),
            .ranking-table td:nth-child(4) {
                display: none;
            }
        }

        /* ===========================
           CONTROL SIZE VARIATIONS
        =========================== */

        /* Small Controls */
        .mobile-controls.size-small .joystick-container,
        .mobile-controls.size-small .shoot-joystick-container {
            width: clamp(70px, 14vw, 90px);
            height: clamp(70px, 14vw, 90px);
        }
        .mobile-controls.size-small .joystick-base {
            width: 100%;
            height: 100%;
        }
        .mobile-controls.size-small .joystick-stick {
            width: 32px;
            height: 32px;
        }
        .mobile-controls.size-small .action-btn,
        .mobile-controls.size-small .ability-btn-small {
            /* Si quieres escalar los botones, puedes usar scale aqu√≠ */
        }

        /* Normal Controls (default) */
        .mobile-controls.size-normal .joystick-container,
        .mobile-controls.size-normal .shoot-joystick-container {
            width: 120px;
            height: 120px;
        }
        .mobile-controls.size-normal .joystick-base {
            width: 100%;
            height: 100%;
        }
        .mobile-controls.size-normal .joystick-stick {
            width: 50px;
            height: 50px;
        }

        /* Large Controls */
        .mobile-controls.size-large .joystick-container,
        .mobile-controls.size-large .shoot-joystick-container {
            width: clamp(110px, 22vw, 150px);
            height: clamp(110px, 22vw, 150px);
        }
        .mobile-controls.size-large .joystick-base {
            width: 100%;
            height: 100%;
        }
        .mobile-controls.size-large .joystick-stick {
            width: 70px;
            height: 70px;
        }
        .mobile-controls.size-large .action-btn,
        .mobile-controls.size-large .ability-btn-small {
            /* Si quieres escalar los botones, puedes usar scale aqu√≠ */
        }

        /* ===========================
           COMPACT SETTINGS LIST STYLES
        =========================== */

        /* Setting Item Container */
        .setting-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: clamp(12px, 2.4vh, 16px) clamp(16px, 3.2vw, 22px);
            background: linear-gradient(135deg, rgba(26, 0, 51, 0.4) 0%, rgba(10, 10, 40, 0.4) 100%);
            border: 1px solid rgba(255, 0, 255, 0.25);
            border-radius: 12px;
            backdrop-filter: blur(12px);
            box-shadow:
                0 4px 16px rgba(0, 0, 0, 0.25),
                inset 0 0 20px rgba(255, 0, 255, 0.03);
            transition: all 0.3s ease;
            margin-bottom: clamp(8px, 1.6vh, 12px);
        }

        .setting-item:hover {
            border-color: rgba(255, 0, 255, 0.4);
            box-shadow:
                0 6px 20px rgba(0, 0, 0, 0.3),
                inset 0 0 25px rgba(255, 0, 255, 0.05);
            transform: translateY(-1px);
        }

        .setting-item:last-child {
            margin-bottom: 0;
        }

        /* Setting Info (Left side) */
        .setting-info {
            display: flex;
            align-items: center;
            gap: clamp(10px, 2vw, 14px);
            flex: 1;
        }

        .setting-icon {
            width: clamp(24px, 5vw, 32px);
            height: clamp(24px, 5vw, 32px);
            object-fit: contain;
            opacity: 0.8;
            transition: opacity 0.3s ease;
        }

        .setting-item:hover .setting-icon {
            opacity: 1;
        }

        .setting-name {
            font-size: clamp(14px, 2.8vw, 18px);
            font-weight: 600;
            color: #fff;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin: 0;
        }

        /* Setting Control (Right side) */
        .setting-control {
            display: flex;
            align-items: center;
            gap: clamp(8px, 1.6vw, 12px);
        }

        /* Radio Group Styles */
        .radio-group {
            display: flex;
            gap: clamp(6px, 1.2vw, 10px);
            flex-wrap: wrap;
        }

        .radio-option {
            position: relative;
        }

        .radio-option input[type="radio"] {
            position: absolute;
            opacity: 0;
            width: 0;
            height: 0;
        }

        .radio-option label {
            display: flex;
            align-items: center;
            gap: clamp(4px, 0.8vw, 6px);
            padding: clamp(6px, 1.2vh, 8px) clamp(8px, 1.6vw, 12px);
            background: rgba(20, 20, 50, 0.5);
            border: 1px solid rgba(255, 0, 255, 0.2);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: clamp(12px, 2.4vw, 14px);
            font-weight: 500;
            color: rgba(255, 255, 255, 0.8);
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        .radio-option input[type="radio"]:checked + label {
            background: linear-gradient(135deg, rgba(255, 0, 255, 0.3), rgba(0, 255, 255, 0.3));
            border-color: #00ffff;
            color: #fff;
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.3);
        }

        .radio-option label:hover {
            border-color: rgba(0, 255, 255, 0.4);
            transform: translateY(-1px);
        }

        /* Difficulty Icons */
        .difficulty-icon {
            width: clamp(16px, 3.2vw, 20px);
            height: clamp(16px, 3.2vw, 20px);
            object-fit: contain;
            opacity: 0.7;
        }

        .radio-option input[type="radio"]:checked + label .difficulty-icon {
            opacity: 1;
        }

        /* ===========================
           MODERN SETTINGS DESIGN
        =========================== */

        /* Logout Item */
        .logout-item {
            margin-bottom: clamp(30px, 5vh, 50px);
        }

        .logout-btn-full {
            width: 100%;
            background: linear-gradient(135deg, rgba(255, 0, 85, 0.15), rgba(255, 0, 0, 0.15));
            border: 2px solid rgba(255, 0, 85, 0.5);
            color: #ff3366;
            padding: clamp(16px, 3.2vh, 22px);
            border-radius: 16px;
            font-size: clamp(16px, 3.2vw, 20px);
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 2px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: clamp(12px, 2.4vw, 16px);
            box-shadow: 0 4px 20px rgba(255, 0, 85, 0.2);
        }

        .logout-btn-full:hover {
            background: linear-gradient(135deg, rgba(255, 0, 85, 0.25), rgba(255, 0, 0, 0.25));
            border-color: #ff0055;
            box-shadow: 0 0 30px rgba(255, 0, 85, 0.5);
            transform: translateY(-2px);
        }

        .logout-btn-full:active {
            transform: translateY(0);
        }

        .logout-icon {
            width: clamp(20px, 4vw, 26px);
            height: clamp(20px, 4vw, 26px);
        }

        .logout-text {
            font-weight: 800;
        }

        /* Modern Setting Item */
        .setting-item-modern {
            background: linear-gradient(135deg, rgba(26, 0, 51, 0.6), rgba(10, 10, 40, 0.6));
            border: 2px solid rgba(0, 255, 255, 0.2);
            border-radius: 18px;
            padding: clamp(18px, 3.6vh, 26px) clamp(20px, 4vw, 28px);
            backdrop-filter: blur(15px);
            box-shadow:
                0 4px 20px rgba(0, 0, 0, 0.3),
                inset 0 0 30px rgba(0, 255, 255, 0.05);
            transition: all 0.3s ease;
        }

        .setting-item-modern:hover {
            border-color: rgba(0, 255, 255, 0.4);
            box-shadow:
                0 6px 25px rgba(0, 0, 0, 0.4),
                inset 0 0 40px rgba(0, 255, 255, 0.08);
            transform: translateY(-2px);
        }

        /* Setting Label Modern */
        .setting-label-modern {
            display: flex;
            align-items: center;
            gap: clamp(12px, 2.4vw, 16px);
            margin-bottom: clamp(16px, 3.2vh, 22px);
        }

        .setting-icon-modern {
            width: clamp(24px, 4.8vw, 32px);
            height: clamp(24px, 4.8vw, 32px);
            color: #00ffff;
            filter: drop-shadow(0 0 8px rgba(0, 255, 255, 0.6));
        }

        .setting-name-modern {
            font-size: clamp(16px, 3.2vw, 20px);
            font-weight: 700;
            color: #fff;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            text-shadow: 0 0 15px rgba(0, 255, 255, 0.4);
        }

        /* Slider Container Modern */
        .slider-container-modern {
            display: flex;
            align-items: center;
            gap: clamp(16px, 3.2vw, 22px);
        }

        .slider-modern {
            -webkit-appearance: none;
            appearance: none;
            flex: 1;
            height: clamp(8px, 1.6vh, 10px);
            background: linear-gradient(90deg,
                rgba(0, 255, 255, 0.3) 0%,
                rgba(255, 0, 255, 0.3) 50%,
                rgba(0, 255, 255, 0.3) 100%);
            border-radius: 10px;
            outline: none;
            border: 1px solid rgba(0, 255, 255, 0.4);
            position: relative;
        }

        .slider-modern::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: clamp(22px, 4.4vw, 28px);
            height: clamp(22px, 4.4vw, 28px);
            background: linear-gradient(135deg, #00ffff, #ff00ff);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.8);
            transition: all 0.2s ease;
        }

        .slider-modern::-webkit-slider-thumb:hover {
            transform: scale(1.2);
            box-shadow: 0 0 30px rgba(0, 255, 255, 1);
        }

        .slider-modern::-moz-range-thumb {
            width: clamp(22px, 4.4vw, 28px);
            height: clamp(22px, 4.4vw, 28px);
            background: linear-gradient(135deg, #00ffff, #ff00ff);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.8);
            border: none;
            transition: all 0.2s ease;
        }

        .slider-modern::-moz-range-thumb:hover {
            transform: scale(1.2);
            box-shadow: 0 0 30px rgba(0, 255, 255, 1);
        }

        .slider-value-modern {
            font-size: clamp(16px, 3.2vw, 20px);
            font-weight: 800;
            color: #00ffff;
            min-width: clamp(50px, 10vw, 65px);
            text-align: center;
            text-shadow: 0 0 15px rgba(0, 255, 255, 0.8);
            background: rgba(0, 255, 255, 0.1);
            padding: clamp(4px, 0.8vh, 6px) clamp(8px, 1.6vw, 12px);
            border-radius: 8px;
            border: 1px solid rgba(0, 255, 255, 0.3);
        }

        /* Toggle Switch Modern */
        .toggle-switch-modern {
            position: relative;
            width: clamp(60px, 12vw, 75px);
            height: clamp(30px, 6vh, 38px);
            background: rgba(100, 100, 100, 0.3);
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid rgba(255, 255, 255, 0.2);
            flex-shrink: 0;
        }

        .toggle-switch-modern.active {
            background: linear-gradient(135deg, rgba(0, 255, 255, 0.3), rgba(255, 0, 255, 0.3));
            border-color: #00ffff;
            box-shadow: 0 0 25px rgba(0, 255, 255, 0.6);
        }

        .toggle-slider-modern {
            position: absolute;
            top: 3px;
            left: 3px;
            width: clamp(22px, 4.4vw, 28px);
            height: clamp(22px, 4.4vw, 28px);
            background: linear-gradient(135deg, #666, #888);
            border-radius: 50%;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.4);
        }

        .toggle-switch-modern.active .toggle-slider-modern {
            transform: translateX(clamp(30px, 6vw, 37px));
            background: linear-gradient(135deg, #00ffff, #ff00ff);
            box-shadow: 0 0 20px rgba(0, 255, 255, 1);
        }

        /* Control Mode Selector */
        .control-mode-selector {
            display: flex;
            align-items: center;
            gap: clamp(8px, 1.6vw, 12px);
            background: rgba(0, 0, 0, 0.3);
            padding: clamp(6px, 1.2vh, 8px);
            border-radius: 12px;
            border: 1px solid rgba(0, 255, 255, 0.2);
        }

        .mode-btn {
            flex: 1;
            background: rgba(20, 20, 50, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.6);
            padding: clamp(12px, 2.4vh, 16px);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: clamp(4px, 0.8vh, 6px);
        }

        .mode-btn.active {
            background: linear-gradient(135deg, rgba(0, 255, 255, 0.2), rgba(255, 0, 255, 0.2));
            border-color: #00ffff;
            color: #00ffff;
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.4);
        }

        .mode-btn:hover:not(.active) {
            border-color: rgba(0, 255, 255, 0.4);
            color: rgba(0, 255, 255, 0.8);
        }

        .mode-label {
            font-size: clamp(14px, 2.8vw, 18px);
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .mode-sublabel {
            font-size: clamp(10px, 2vw, 12px);
            opacity: 0.7;
        }

        .mode-divider {
            width: clamp(24px, 4.8vw, 32px);
            height: clamp(24px, 4.8vw, 32px);
            display: flex;
            align-items: center;
            justify-content: center;
            color: rgba(0, 255, 255, 0.4);
        }

        .mode-divider svg {
            width: 100%;
            height: 100%;
        }

        /* Size Selector */
        .size-selector {
            display: flex;
            gap: clamp(10px, 2vw, 14px);
            background: rgba(0, 0, 0, 0.3);
            padding: clamp(8px, 1.6vh, 10px);
            border-radius: 12px;
            border: 1px solid rgba(0, 255, 255, 0.2);
        }

        .size-btn {
            flex: 1;
            background: rgba(20, 20, 50, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.6);
            padding: clamp(14px, 2.8vh, 18px);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: clamp(6px, 1.2vh, 8px);
        }

        .size-btn.active {
            background: linear-gradient(135deg, rgba(0, 255, 255, 0.2), rgba(255, 0, 255, 0.2));
            border-color: #00ffff;
            color: #00ffff;
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.4);
        }

        .size-btn:hover:not(.active) {
            border-color: rgba(0, 255, 255, 0.4);
            color: rgba(0, 255, 255, 0.8);
            transform: scale(1.05);
        }

        .size-btn svg {
            width: clamp(20px, 4vw, 28px);
            height: clamp(20px, 4vw, 28px);
        }

        .size-btn span {
            font-size: clamp(14px, 2.8vw, 18px);
            font-weight: 700;
        }

        /* Compact Logout Button */
        .logout-btn-compact {
            display: flex;
            align-items: center;
            gap: clamp(6px, 1.2vw, 8px);
            padding: clamp(8px, 1.6vh, 12px) clamp(12px, 2.4vw, 16px);
            background: linear-gradient(135deg, rgba(255, 0, 0, 0.3), rgba(200, 0, 0, 0.3));
            border: 1px solid rgba(255, 0, 0, 0.5);
            color: #ff6666;
            border-radius: 8px;
            font-size: clamp(12px, 2.4vw, 14px);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(255, 0, 0, 0.2);
        }

        .logout-btn-compact:hover {
            background: linear-gradient(135deg, rgba(255, 0, 0, 0.5), rgba(200, 0, 0, 0.5));
            border-color: #ff0000;
            box-shadow: 0 0 20px rgba(255, 0, 0, 0.5);
            transform: translateY(-1px);
        }

        .logout-btn-compact svg {
            width: clamp(14px, 2.8vw, 18px);
            height: clamp(14px, 2.8vw, 18px);
        }

        /* Responsive adjustments for compact settings */
        @media (max-width: 480px) {
            .setting-item {
                padding: 10px 12px;
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }

            .setting-info {
                width: 100%;
            }

            .setting-control {
                width: 100%;
                justify-content: flex-start;
            }

            .radio-group {
                width: 100%;
                justify-content: space-between;
            }

            .radio-option label {
                flex: 1;
                justify-content: center;
                text-align: center;
            }
        }

        /* ===========================
           UPGRADE MODAL STYLES
        =========================== */
        .upgrade-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 10000;
            overflow-y: auto;
            padding: clamp(8px, 2vw, 15px);
        }

        .upgrade-modal.active {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
        }

        .upgrade-container {
            width: 100%;
            max-width: 850px;
            background: linear-gradient(135deg, rgba(0, 20, 40, 0.9), rgba(20, 0, 40, 0.9));
            border: 2px solid #00ffff;
            border-radius: 15px;
            padding: clamp(12px, 2.5vw, 20px);
            box-shadow: 0 0 50px rgba(0, 255, 255, 0.3);
            margin: auto;
        }

        .upgrade-title {
            font-size: clamp(20px, 4vw, 32px);
            font-weight: bold;
            background: linear-gradient(45deg, #00ffff, #ff00ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-align: center;
            margin-bottom: clamp(10px, 2vw, 15px);
            text-transform: uppercase;
            letter-spacing: 2px;
            text-shadow: 0 0 20px rgba(0, 255, 255, 0.5);
        }

        .xp-section {
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(0, 255, 255, 0.3);
            border-radius: 10px;
            padding: clamp(10px, 2vw, 15px);
            margin-bottom: clamp(12px, 2.5vw, 18px);
        }

        .xp-earned {
            text-align: center;
            font-size: clamp(13px, 2.5vw, 16px);
            color: #00ffff;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .xp-bar-container {
            width: 100%;
            height: clamp(24px, 4vw, 30px);
            background: rgba(0, 0, 0, 0.6);
            border: 2px solid #00ffff;
            border-radius: 15px;
            overflow: hidden;
            position: relative;
            margin-bottom: 12px;
        }

        .xp-bar {
            height: 100%;
            background: linear-gradient(90deg, #00ffff, #0088ff);
            width: 0%;
            transition: width 0.5s ease;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.5);
            position: relative;
        }

        .xp-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .xp-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: clamp(12px, 2.2vw, 15px);
            font-weight: bold;
            color: #fff;
            text-shadow: 0 0 10px rgba(0, 0, 0, 0.8);
            z-index: 1;
        }

        .enemy-xp-breakdown {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(90px, 1fr));
            gap: clamp(6px, 1.5vw, 10px);
            margin-top: 10px;
        }

        .enemy-xp-item {
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: clamp(6px, 1.2vw, 10px);
            text-align: center;
            transition: all 0.3s;
        }

        .enemy-xp-item:hover {
            border-color: #00ffff;
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.3);
        }

        .enemy-icon {
            font-size: clamp(18px, 3.5vw, 24px);
            margin-bottom: 3px;
        }

        .enemy-xp-amount {
            font-size: clamp(11px, 2.2vw, 14px);
            color: #00ffff;
            font-weight: 600;
        }

        .enemy-xp-label {
            font-size: clamp(9px, 1.8vw, 11px);
            color: #888;
            text-transform: uppercase;
        }

        .upgrades-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: clamp(8px, 1.8vw, 12px);
            margin-bottom: clamp(12px, 2.5vw, 18px);
        }

        .upgrade-card {
            background: rgba(0, 0, 0, 0.6);
            border: 2px solid rgba(0, 255, 255, 0.3);
            border-radius: 12px;
            padding: clamp(10px, 2vw, 14px);
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .upgrade-card:hover {
            border-color: #00ffff;
            box-shadow: 0 0 25px rgba(0, 255, 255, 0.4);
            transform: translateY(-2px);
        }

        .upgrade-card.upgrading {
            animation: upgradeFlash 0.5s ease;
        }

        @keyframes upgradeFlash {
            0%, 100% { transform: scale(1); box-shadow: 0 0 25px rgba(0, 255, 255, 0.4); }
            50% { transform: scale(1.05); box-shadow: 0 0 40px rgba(0, 255, 255, 0.8); }
        }

        .upgrade-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 6px;
        }

        .upgrade-name {
            font-size: clamp(12px, 2.4vw, 15px);
            font-weight: bold;
            color: #00ffff;
            text-transform: uppercase;
        }

        .upgrade-level {
            font-size: clamp(11px, 2.2vw, 14px);
            color: #ff00ff;
            font-weight: 600;
        }

        .upgrade-description {
            font-size: clamp(10px, 2vw, 12px);
            color: #aaa;
            margin-bottom: 8px;
            min-height: 2.2em;
            line-height: 1.3;
        }

        .upgrade-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .upgrade-cost {
            font-size: clamp(11px, 2.3vw, 14px);
            color: #ffaa00;
            font-weight: 600;
        }

        .upgrade-btn {
            width: clamp(30px, 6vw, 38px);
            height: clamp(30px, 6vw, 38px);
            border: 2px solid #00ffff;
            background: rgba(0, 255, 255, 0.1);
            color: #00ffff;
            font-size: clamp(18px, 3.5vw, 24px);
            font-weight: bold;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .upgrade-btn:hover:not(:disabled) {
            background: #00ffff;
            color: #000;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.6);
            transform: scale(1.1);
        }

        .upgrade-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .upgrade-actions {
            display: flex;
            gap: clamp(8px, 1.5vw, 12px);
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn-upgrade-action {
            padding: clamp(10px, 2vw, 14px) clamp(20px, 4vw, 32px);
            font-size: clamp(12px, 2.4vw, 16px);
            font-weight: 600;
            text-transform: uppercase;
            border: 2px solid;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            letter-spacing: 1px;
        }

        .btn-undo {
            background: rgba(255, 0, 85, 0.1);
            border-color: #ff0055;
            color: #ff0055;
        }

        .btn-undo:hover {
            background: #ff0055;
            color: #fff;
            box-shadow: 0 0 20px rgba(255, 0, 85, 0.5);
        }

        .btn-accept {
            background: rgba(0, 255, 85, 0.1);
            border-color: #00ff55;
            color: #00ff55;
        }

        .btn-accept:hover {
            background: #00ff55;
            color: #000;
            box-shadow: 0 0 20px rgba(0, 255, 85, 0.5);
        }

        @media (max-width: 600px) {
            .upgrades-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .enemy-xp-breakdown {
                grid-template-columns: repeat(3, 1fr);
            }

            .upgrade-container {
                padding: 10px;
            }

            .upgrade-title {
                margin-bottom: 8px;
            }

            .xp-section {
                padding: 8px;
                margin-bottom: 10px;
            }
        }

        @media (max-width: 400px) {
            .upgrades-grid {
                grid-template-columns: 1fr;
            }
            
            .enemy-xp-breakdown {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <!-- Elemento requerido por game.js para controles m√≥viles -->
    <span class="platform-specific mobile" style="display:none"></span>
    <!-- Start Menu / Login Screen -->
    <div class="start-menu" id="startMenu">
        <!-- Hero Section -->
        <div class="menu-hero">
            <div class="menu-logo">NEON SURVIVOR</div>
            <div class="menu-subtitle">Battle Royale Arena</div>
        </div>

        <!-- Google Sign-In (cuando NO est√° logueado) -->
        <div id="loginContainer" class="login-container-wrapper">
            <div class="login-card">
                <div class="login-card-title">Join the Arena</div>

                <button class="google-signin-btn" id="googleSignInBtn">
                    <svg class="google-icon" viewBox="0 0 24 24">
                        <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                        <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                        <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                        <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                    </svg>
                    <span class="btn-text">Sign in with Google</span>
                </button>

                <div class="login-divider">
                    <span class="divider-line"></span>
                    <span class="divider-text">OR</span>
                    <span class="divider-line"></span>
                </div>

                <button class="guest-btn" id="guestPlayBtn">
                    <svg class="guest-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                        <circle cx="12" cy="7" r="4"></circle>
                    </svg>
                    <span class="btn-text">Continue as Guest</span>
                </button>

            </div>
        </div>

        <!-- User Menu (cuando est√° logueado) -->
        <div id="userMenuContainer" class="user-menu-wrapper" style="display:none;">
            <!-- User Profile Card -->
            <div class="user-profile-card action-card">
                <div class="profile-header">
                    <img id="userAvatar" class="user-avatar" src="" alt="User">
                    <div class="profile-info">
                        <div class="user-name" id="userName"></div>
                        <span id="guestIndicator" class="guest-badge" style="display:none;">
                            <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor">
                                <circle cx="12" cy="12" r="10"/>
                            </svg>
                            GUEST
                        </span>
                        <div id="userBestScore" class="user-best-score" style="display:none;">
                            <span class="best-score-label">Mejor puntuaci√≥n:</span>
                            <span id="bestScoreValue">0</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Action Grid -->
            <div class="action-grid">
                <!-- Primary Action -->
                <button class="action-card primary-action" id="startGameBtn">
                    <div class="action-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                            <polygon points="5 3 19 12 5 21 5 3"></polygon>
                        </svg>
                    </div>
                    <div class="action-content">
                        <div class="action-title">START GAME</div>
                        <div class="action-subtitle">Begin from Wave 1</div>
                    </div>
                </button>

                <!-- Secondary Actions -->
                <button class="action-card secondary-action" id="levelSelectBtn">
                    <div class="action-icon-small">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="3" width="7" height="7"></rect>
                            <rect x="14" y="3" width="7" height="7"></rect>
                            <rect x="14" y="14" width="7" height="7"></rect>
                            <rect x="3" y="14" width="7" height="7"></rect>
                        </svg>
                    </div>
                    <div class="action-content">
                        <div class="action-title">SELECT LEVEL</div>
                        <div class="action-subtitle">Choose starting wave</div>
                    </div>
                </button>

                <button class="action-card secondary-action" id="statsBtn">
                    <div class="action-icon-small">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 3v18h18"></path>
                            <path d="M18 17V9"></path>
                            <path d="M13 17V5"></path>
                            <path d="M8 17v-3"></path>
                        </svg>
                    </div>
                    <div class="action-content">
                        <div class="action-title">STATS</div>
                        <div class="action-subtitle">Rankings & achievements</div>
                    </div>
                </button>

                <button class="action-card secondary-action" id="settingsBtn">
                    <div class="action-icon-small">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="3"></circle>
                            <path d="M12 1v6m0 6v6m5.2-14.8l-4.2 4.2m-2 2l-4.2 4.2M23 12h-6m-6 0H1m14.8 5.2l-4.2-4.2m-2-2l-4.2-4.2"></path>
                        </svg>
                    </div>
                    <div class="action-content">
                        <div class="action-title">SETTINGS</div>
                        <div class="action-subtitle">Controls & preferences</div>
                    </div>
                </button>

                <!-- Login Button (for guests) -->
                <button class="action-card login-action" id="loginBtn" style="display:none;">
                    <div class="action-icon-small">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4m-5-4l5-5-5-5m5 5H3"></path>
                        </svg>
                    </div>
                    <div class="action-content">
                        <div class="action-title">LOGIN</div>
                        <div class="action-subtitle">Save your progress</div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Settings Menu -->
    <div class="settings-menu" id="settingsMenu">
        <div class="settings-container">
            <div class="settings-header">
                <div class="settings-title">‚öôÔ∏è SETTINGS</div>
                <button class="close-settings-btn" id="closeSettingsBtn">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>

            <div class="settings-content">

                <!-- 1. LOGOUT BUTTON -->
                <div class="setting-item logout-item" id="logoutItem" style="display:none;">
                    <button class="logout-btn-full" id="logoutBtn">
                        <svg class="logout-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                            <polyline points="16 17 21 12 16 7"></polyline>
                            <line x1="21" y1="12" x2="9" y2="12"></line>
                        </svg>
                        <span class="logout-text">LOGOUT</span>
                    </button>
                </div>

                <!-- 2. VOLUME CONTROL -->
                <div class="setting-item-modern">
                    <div class="setting-label-modern">
                        <svg class="setting-icon-modern" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                            <path d="M15.54 8.46a5 5 0 0 1 0 7.07"></path>
                            <path d="M19.07 4.93a10 10 0 0 1 0 14.14"></path>
                        </svg>
                        <span class="setting-name-modern">VOLUME</span>
                    </div>
                    <div class="slider-container-modern">
                        <input type="range" class="slider-modern" id="masterVolume" min="0" max="100" value="70">
                        <div class="slider-value-modern" id="masterVolumeValue">70%</div>
                    </div>
                </div>

                <!-- 3. HAPTIC FEEDBACK -->
                <div class="setting-item-modern">
                    <div class="setting-label-modern">
                        <svg class="setting-icon-modern" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="5" y="2" width="14" height="20" rx="2" ry="2"></rect>
                            <line x1="12" y1="18" x2="12.01" y2="18"></line>
                        </svg>
                        <span class="setting-name-modern">HAPTIC FEEDBACK</span>
                    </div>
                    <div class="toggle-switch-modern active" id="hapticToggle">
                        <div class="toggle-slider-modern"></div>
                    </div>
                </div>

                <!-- 4. CONTROL SCHEME -->
                <div class="setting-item-modern">
                    <div class="setting-label-modern">
                        <svg class="setting-icon-modern" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="3"></circle>
                            <path d="M3 12h6m6 0h6M12 3v6m0 6v6"></path>
                            <path d="M8 8l-4 4m16 0l-4-4M8 16l-4-4m16 0l-4 4"></path>
                        </svg>
                        <span class="setting-name-modern">CONTROL SCHEME</span>
                    </div>
                    <div class="control-options">
                        <div class="control-option">
                            <input type="radio" id="controlDefault" name="controlScheme" value="default" checked>
                            <label for="controlDefault">
                                <div class="option-icon">üïπÔ∏è</div>
                                <div class="option-content">
                                    <div class="option-title">Default Joysticks</div>
                                    <div class="option-desc">Right: Move | Left: Shoot</div>
                                </div>
                            </label>
                        </div>
                        <div class="control-option">
                            <input type="radio" id="controlInverted" name="controlScheme" value="inverted">
                            <label for="controlInverted">
                                <div class="option-icon">üîÑ</div>
                                <div class="option-content">
                                    <div class="option-title">Inverted Joysticks</div>
                                    <div class="option-desc">Right: Shoot | Left: Move</div>
                                </div>
                            </label>
                        </div>
                        <div class="control-option">
                            <input type="radio" id="controlTap" name="controlScheme" value="tap">
                            <label for="controlTap">
                                <div class="option-icon">üëÜ</div>
                                <div class="option-content">
                                    <div class="option-title">Tap to Action</div>
                                    <div class="option-desc">Tap enemy to shoot | Tap ground to move</div>
                                </div>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- 5. CONTROLS SIZE -->
                <div class="setting-item-modern">
                    <div class="setting-label-modern">
                        <svg class="setting-icon-modern" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="3" width="7" height="7"></rect>
                            <rect x="14" y="3" width="7" height="7"></rect>
                            <rect x="14" y="14" width="7" height="7"></rect>
                            <rect x="3" y="14" width="7" height="7"></rect>
                        </svg>
                        <span class="setting-name-modern">CONTROLS SIZE</span>
                    </div>
                    <div class="size-selector">
                        <button class="size-btn" id="sizeSmall" data-size="small">
                            <svg viewBox="0 0 24 24" fill="currentColor">
                                <circle cx="12" cy="12" r="4"></circle>
                            </svg>
                            <span>S</span>
                        </button>
                        <button class="size-btn active" id="sizeNormal" data-size="normal">
                            <svg viewBox="0 0 24 24" fill="currentColor">
                                <circle cx="12" cy="12" r="6"></circle>
                            </svg>
                            <span>M</span>
                        </button>
                        <button class="size-btn" id="sizeLarge" data-size="large">
                            <svg viewBox="0 0 24 24" fill="currentColor">
                                <circle cx="12" cy="12" r="8"></circle>
                            </svg>
                            <span>L</span>
                        </button>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- Level Selector Modal -->
    <div class="level-selector" id="levelSelector">
        <button class="close-level-selector" id="closeLevelSelector">√ó</button>
        <div class="level-selector-title">SELECT WAVE</div>
        <div class="level-grid" id="levelGrid"></div>
    </div>

    <!-- Stats & Ranking Page -->
    <div class="stats-page" id="statsPage">
        <div class="stats-header">
            <div class="stats-title">Stats & Ranking</div>
            <button class="close-stats-btn" id="closeStatsBtn">√ó</button>
        </div>
                <!-- Tabs -->
        <div class="stats-tabs">
            <button class="tab-btn active" data-tab="daily-score" data-period="daily">Daily</button>
            <button class="tab-btn" data-tab="monthly-score" data-period="monthly">Monthly</button>
            <button class="tab-btn" data-tab="alltime-score" data-period="alltime">All-Time</button>
        </div>

        <!-- Mis Estad√≠sticas -->
        <div class="ranking-section">
            <div class="section-title">My Stats</div>
            <div class="my-stats" id="myStats">
                <div class="stat-box">
                    <div class="stat-box-value" id="totalGames">-</div>
                    <div class="stat-box-label">Total Games</div>
                </div>
                <div class="stat-box">
                    <div class="stat-box-value" id="bestScore">-</div>
                    <div class="stat-box-label">Best Score</div>
                </div>
                <div class="stat-box">
                    <div class="stat-box-value" id="bestWave">-</div>
                    <div class="stat-box-label">Max Wave</div>
                </div>
                <div class="stat-box">
                    <div class="stat-box-value" id="totalKills">-</div>
                    <div class="stat-box-label">Total Kills</div>
                </div>
            </div>
            <div class="loading-stats" id="myStatsLoading" style="display:none;">Loading...</div>
        </div>



        <!-- Daily Score -->
        <div class="stats-content active" id="daily-score">
            <div class="ranking-section">
                <div class="section-title">Best Score Today</div>
                <div class="loading-stats">Loading...</div>
                <table class="ranking-table" id="dailyScoreTable" style="display:none;">
                    <thead>
                        <tr>
                            <th>Rank</th>
                            <th>Player</th>
                            <th>Score</th>
                            <th>Wave</th>
                        </tr>
                    </thead>
                    <tbody id="dailyScoreBody"></tbody>
                </table>
            </div>
        </div>

        <!-- Monthly Score -->
        <div class="stats-content" id="monthly-score">
            <div class="ranking-section">
                <div class="section-title">Best Score (Last 30 Days)</div>
                <div class="loading-stats">Loading...</div>
                <table class="ranking-table" id="monthlyScoreTable" style="display:none;">
                    <thead>
                        <tr>
                            <th>Rank</th>
                            <th>Player</th>
                            <th>Score</th>
                            <th>Wave</th>
                        </tr>
                    </thead>
                    <tbody id="monthlyScoreBody"></tbody>
                </table>
            </div>
        </div>

        <!-- All-Time Score -->
        <div class="stats-content" id="alltime-score">
            <div class="ranking-section">
                <div class="section-title">All-Time Best Score</div>
                <div class="loading-stats">Loading...</div>
                <table class="ranking-table" id="alltimeScoreTable" style="display:none;">
                    <thead>
                        <tr>
                            <th>Rank</th>
                            <th>Player</th>
                            <th>Score</th>
                            <th>Wave</th>
                        </tr>
                    </thead>
                    <tbody id="alltimeScoreBody"></tbody>
                </table>
            </div>
        </div>

    </div>

    <!-- Loading Screen -->
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-logo">NEON SURVIVOR</div>
        <div class="loading-subtitle">Battle Royale Arena</div>
        <div class="loading-bar">
            <div class="loading-progress"></div>
        </div>
    </div>


    <!-- HUD - FULL WIDTH TOP BAR -->
    <div class="hud" id="gameHUD">
        <div class="hud-panel">
            <div class="hud-label">WAVE</div>
            <div class="hud-value" id="waveDisplay">1</div>
        </div>
        <div class="hud-panel health-panel">
            <div class="hud-label">HP</div>
            <div class="hud-value" id="healthText">100</div>
            <div class="health-bar-container">
                <div class="health-bar" id="healthBar" style="width: 100%;"></div>
            </div>
        </div>
        <div class="hud-panel">
            <div class="hud-label">KILLS</div>
            <div class="hud-value" id="killsDisplay">0</div>
        </div>
        <div class="hud-panel">
            <div class="hud-label">ENEMIES</div>
            <div class="hud-value" id="enemiesDisplay">0/0</div>
        </div>
        <div class="hud-panel">
            <div class="hud-label">SCORE</div>
            <div class="hud-value" id="scoreDisplay">0</div>
        </div>
    </div>

    <!-- Mobile Controls -->
    <div class="mobile-controls" id="mobileControls">
        <!-- Pause Button -->
        <button class="pause-btn-mobile" id="pauseBtnMobile"></button>

        <!-- Move Joystick (Left) -->
        <div class="joystick-container" id="joystickContainer">
            <div class="joystick-base" id="joystickBase"></div>
            <div class="joystick-stick" id="joystickStick"></div>
        </div>

        <!-- Shoot Joystick (Right) - Only visible in dual joystick mode -->
        <div class="shoot-joystick-container" id="shootJoystickContainer" style="display:none;">
            <div class="joystick-base" id="shootJoystickBase"></div>
            <div class="joystick-stick" id="shootJoystickStick"></div>
        </div>

        <!-- Action Buttons - For tap mode -->
        <div class="action-buttons" id="actionButtons">
            <button class="action-btn inactive" id="abilityBtn">
                ‚ö°
                <span class="btn-label">ABILITY</span>
                <div class="cooldown-overlay">
                    <span class="cooldown-text">0</span>
                </div>
            </button>
        </div>

        <!-- Ability Button Small - For dual joystick mode -->
        <button class="ability-btn-small inactive" id="abilityBtnSmall" style="display:none;">
            ‚ö°
            <div class="cooldown-overlay">
                <span class="cooldown-text">0</span>
            </div>
        </button>
    </div>


    <!-- Notification -->
    <div class="notification" id="notification"></div>

    <!-- Wave Indicator -->
    <div class="wave-indicator" id="waveIndicator"></div>

    <!-- Wave Countdown -->
    <div class="wave-countdown" id="waveCountdown" style="display:none;">
        <div class="countdown-title" id="countdownTitle">WAVE 1</div>
        <div class="countdown-number" id="countdownNumber">5</div>
        <div class="countdown-subtitle">GET READY!</div>
    </div>

    <!-- Upgrade Modal -->
    <div class="upgrade-modal" id="upgradeModal">
        <div class="upgrade-container">
            <div class="upgrade-title">‚ö° LEVEL UP ‚ö°</div>
            
            <!-- XP Section -->
            <div class="xp-section">
                <div class="xp-earned" id="xpEarnedText">You earned 0 experience points this wave!</div>
                
                <!-- XP Bar -->
                <div class="xp-bar-container">
                    <div class="xp-bar" id="xpBar"></div>
                    <div class="xp-text" id="xpText">0 XP</div>
                </div>
                
                <!-- Enemy XP Breakdown -->
                <div class="enemy-xp-breakdown" id="enemyXpBreakdown">
                    <!-- Dynamically generated -->
                </div>
            </div>
            
            <!-- Upgrades Grid -->
            <div class="upgrades-grid" id="upgradesGrid">
                <!-- Dynamically generated -->
            </div>
            
            <!-- Action Buttons -->
            <div class="upgrade-actions">
                <button class="btn-upgrade-action btn-undo" id="undoUpgradesBtn">
                    ‚Ü∂ UNDO CHANGES
                </button>
                <button class="btn-upgrade-action btn-accept" id="acceptUpgradesBtn">
                    ‚úì CONTINUE
                </button>
            </div>
        </div>
    </div>

    <!-- Pause Overlay -->
    <div class="game-over" id="pauseOverlay" style="display:none; z-index:9500; background:rgba(0,0,0,0.97);">
        <h1 style="font-size:70px; background:linear-gradient(45deg,#00ffff,#ff00ff); -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text; text-shadow:0 0 50px #00ffff; margin-bottom:30px; animation:title-glow 2s ease-in-out infinite;">PAUSA</h1>
        <div style="margin-bottom:40px; display: flex; flex-direction: column; gap: 18px; align-items: center;">
            <button class="btn-neon" id="resumeBtn" style="font-size:22px; padding:18px 50px; border-radius:40px;">‚ñ∂ REANUDAR</button>
            <button class="btn-neon" id="abortBtn" style="font-size:20px; padding:14px 44px; border-radius:40px; background: linear-gradient(135deg, #ff0055, #ff00ff); color: #fff;">END GAME</button>
        </div>
    </div>

    <!-- Game Over Screen -->
    <div class="game-over" id="gameOver">
        <h1>GAME OVER</h1>
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value" id="finalWave">0</div>
                <div class="stat-label">Wave Reached</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="finalKills">0</div>
                <div class="stat-label">Total Kills</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="finalScore">0</div>
                <div class="stat-label">Final Score</div>
            </div>
        </div>
        <div>
            <button class="btn-neon" onclick="location.reload()">PLAY AGAIN</button>
        </div>
    </div>

    <!-- Custom Cursor (PC only) -->
    <div class="custom-cursor" id="customCursor">
        <div class="cursor-dot"></div>
        <div class="cursor-ring"></div>
    </div>

    <!-- Main Canvas -->
    <canvas id="gameCanvas"></canvas>

    <script src="game.js"></script>
        <script>
    // --- LOGIN CON GOOGLE Y GESTI√ìN DE USUARIO ---
    let currentUser = null;
    let maxLevelReached = 1; // M√°ximo nivel desbloqueado por el usuario
    window.isGuestMode = false; // Modo invitado (global para que game.js pueda acceder)

    // Elementos del DOM
    const startMenu = document.getElementById('startMenu');
    const loginContainer = document.getElementById('loginContainer');
    const userMenuContainer = document.getElementById('userMenuContainer');
    const googleSignInBtn = document.getElementById('googleSignInBtn');
    const guestPlayBtn = document.getElementById('guestPlayBtn');
    const startGameBtn = document.getElementById('startGameBtn');
    const levelSelectBtn = document.getElementById('levelSelectBtn');
    const levelSelector = document.getElementById('levelSelector');
    const closeLevelSelector = document.getElementById('closeLevelSelector');
    const levelGrid = document.getElementById('levelGrid');
    const loadingScreen = document.getElementById('loadingScreen');
    const guestIndicator = document.getElementById('guestIndicator');
    const loginBtn = document.getElementById('loginBtn');

    // Verificar estado de autenticaci√≥n
    auth.onAuthStateChanged(user => {
      if (user) {
        currentUser = user;
        window.isGuestMode = false;
        showUserMenu(user);
        loadUserProgress(user.uid);
      } else {
        showLoginButton();
      }

      // Ocultar pantalla de carga cuando Firebase est√© listo
      loadingScreen.style.display = 'none';
    });

    // Login con Google
    googleSignInBtn.onclick = function() {
      const provider = new firebase.auth.GoogleAuthProvider();
      auth.signInWithPopup(provider).then(result => {
        const user = result.user;
        currentUser = user;
        window.isGuestMode = false; // No es invitado
        // Datos b√°sicos
        const profile = {
          uid: user.uid,
          nombre: user.displayName || '',
          email: user.email || '',
          foto: user.photoURL || '',
          fechaRegistro: firebase.firestore.Timestamp.now(),
          ultimaConexion: firebase.firestore.Timestamp.now()
        };
        db.collection("usuarios").doc(user.uid).set(profile, { merge: true });
        showUserMenu(user);
        loadUserProgress(user.uid);
      }).catch(error => {
        console.error('Error en login:', error);
      });
    };

    // Jugar como invitado
    guestPlayBtn.onclick = function() {
      window.isGuestMode = true;
      currentUser = null;
      maxLevelReached = 1; // Invitados empiezan desde nivel 1
      showUserMenu({ displayName: 'Guest Player' });
    };

    // Login desde modo invitado
    loginBtn.onclick = function() {
      window.isGuestMode = false;
      currentUser = null;
      showLoginButton();
    };

    // Mostrar bot√≥n de login
    function showLoginButton() {
      loginContainer.style.display = 'block';
      userMenuContainer.style.display = 'none';
    }

    // Mostrar men√∫ de usuario
    function showUserMenu(user) {
      loginContainer.style.display = 'none';
      userMenuContainer.style.display = 'block';

      if (window.isGuestMode) {
        // Modo invitado
        document.getElementById('userName').textContent = 'Guest Player';
        // Usar solo el nombre del archivo si est√° en la misma carpeta que index.html
        document.getElementById('userAvatar').src = 'guest_user_logo.png';
        document.getElementById('userAvatar').alt = 'Guest Avatar';
        guestIndicator.style.display = 'inline-flex';
        loginBtn.style.display = 'flex';
        // Ocultar mejor puntuaci√≥n para invitados
        if (window.showUserBestScore) {
            window.showUserBestScore(0);
        }
      } else {
        // Usuario logueado
        document.getElementById('userName').textContent = user.displayName || 'Player';
        document.getElementById('userAvatar').src = user.photoURL || 'https://via.placeholder.com/64';
        guestIndicator.style.display = 'none';
        loginBtn.style.display = 'none';
        // Cargar y mostrar mejor puntuaci√≥n
        loadBestScore(user.uid);
      }

      // Actualizar visibilidad del bot√≥n de logout
      if (typeof updateLogoutButtonVisibility === 'function') {
          updateLogoutButtonVisibility();
      }
    }

    // Cargar mejor puntuaci√≥n del usuario
    function loadBestScore(uid) {
      db.collection("ranking")
        .where("userId", "==", uid)
        .orderBy("score", "desc")
        .limit(1)
        .get()
        .then(snapshot => {
          if (!snapshot.empty) {
            const bestScore = snapshot.docs[0].data().score || 0;
            if (window.showUserBestScore) {
                window.showUserBestScore(bestScore);
            }
          } else {
            if (window.showUserBestScore) {
                window.showUserBestScore(0);
            }
          }
        })
        .catch(error => {
          console.error('Error loading best score:', error);
          if (window.showUserBestScore) {
              window.showUserBestScore(0);
          }
        });
    }

    // Cargar progreso del usuario
    function loadUserProgress(uid) {
      db.collection("usuarios").doc(uid).collection("partidas")
        .orderBy("wave", "desc")
        .limit(1)
        .get()
        .then(snapshot => {
          if (!snapshot.empty) {
            const lastGame = snapshot.docs[0].data();
            maxLevelReached = lastGame.wave || 1;
          }
        });
    }

    // Iniciar partida desde nivel 1
    startGameBtn.onclick = function() {
      startGame(1);
    };

    // Abrir selector de niveles
    levelSelectBtn.onclick = function() {
      renderLevelSelector();
      levelSelector.classList.add('active');
    };

    // Cerrar selector de niveles
    closeLevelSelector.onclick = function() {
      levelSelector.classList.remove('active');
    };

    // Renderizar selector de niveles
    function renderLevelSelector() {
      levelGrid.innerHTML = '';
      const maxLevel = Math.max(10, maxLevelReached); // M√≠nimo 10 niveles, m√°ximo el √∫ltimo alcanzado

      for (let i = 1; i <= maxLevel; i++) {
        const btn = document.createElement('button');
        btn.className = 'level-btn';
        btn.textContent = i;

        if (i <= maxLevelReached) {
          btn.onclick = () => {
            startGame(i);
            levelSelector.classList.remove('active');
          };
        } else {
          btn.classList.add('locked');
          btn.textContent = 'üîí';
        }

        levelGrid.appendChild(btn);
      }
    }

    // Iniciar juego desde un nivel espec√≠fico
        function startGame(startLevel) {
            gameStartTime = Date.now(); // Registrar inicio de partida
            startMenu.classList.add('hidden');
            // loadingScreen.style.display = 'flex'; // Ya no se muestra loadingScreen en cada partida

            // Asegurar que el overlay de pausa est√© oculto
            if (pauseOverlay) {
                pauseOverlay.style.display = 'none';
            }

            // Establecer wave inicial en el gameState
            if (window.gameState) {
                window.gameState.wave = startLevel;
            }

            // Iniciar el juego inmediatamente (sin mostrar loadingScreen)
            if (window.startGameFromMenu) {
                window.startGameFromMenu(startLevel);
            }
        }

    // Guardar datos extra del usuario (llama a esta funci√≥n cuando tengas los datos)
    function guardarDatosExtra(edad, sexo, region, pais, continente) {
        if (!currentUser) return;
        db.collection("usuarios").doc(currentUser.uid).set({
            edad, sexo, region, pais, continente,
            ultimaConexion: firebase.firestore.Timestamp.now()
        }, { merge: true });
    }

    // Guardar partida/score (llama a esta funci√≥n al terminar una partida)
    function guardarPartida(score, wave, kills, endType = 'FINISHED') {
        if (!currentUser) return;

        const partidaData = {
            score: score,
            wave: wave,
            kills: kills,
            fecha: firebase.firestore.Timestamp.now(),
            duracion: Date.now() - gameStartTime, // Duraci√≥n en milisegundos
            userId: currentUser.uid,
            userName: currentUser.displayName || 'Anonymous',
            endType: endType // 'FINISHED' o 'ABORTED'
        };

        // Guardar en colecci√≥n de usuario
        db.collection("usuarios").doc(currentUser.uid)
            .collection("partidas").add(partidaData)
            .then(() => {
                console.log('‚úÖ Partida guardada correctamente');

                // Actualizar m√°ximo nivel alcanzado si es mayor
                if (wave > maxLevelReached) {
                    maxLevelReached = wave;
                    db.collection("usuarios").doc(currentUser.uid).set({
                        maxLevelReached: wave,
                        ultimaConexion: firebase.firestore.Timestamp.now()
                    }, { merge: true });
                }
            })
            .catch(error => {
                console.error('‚ùå Error guardando partida:', error);
            });

        // Guardar en colecci√≥n global de ranking
        db.collection("ranking").add(partidaData)
            .then(() => {
                console.log('‚úÖ Partida a√±adida al ranking global');
            })
            .catch(error => {
                console.error('‚ùå Error guardando en ranking global:', error);
            });
    }

    // Hacer la funci√≥n global para que game.js pueda llamarla
    window.guardarPartida = guardarPartida;

    // Variable para rastrear el inicio de partida
    let gameStartTime = null;

    // ===================================
    // STATS & RANKING PAGE
    // ===================================

    const statsPage = document.getElementById('statsPage');
    const statsBtn = document.getElementById('statsBtn');
    const closeStatsBtn = document.getElementById('closeStatsBtn');
    const tabBtns = document.querySelectorAll('.stats-tabs .tab-btn');

    // Abrir p√°gina de stats
    statsBtn.onclick = function() {
        // Verificar si es invitado
        if (window.isGuestMode) {
            alert('üîí Rankings only available for registered users!\n\n‚ú® Sign in with Google to:\n‚Ä¢ Access daily, monthly, and all-time rankings\n‚Ä¢ Save your progress across devices\n‚Ä¢ See fewer ads and enjoy more gameplay!\n\nTap the "LOGIN WITH GOOGLE" button to get started.');
            return;
        }

        statsPage.classList.add('active');
        loadMyStats();
        loadRanking('daily-score');
        // --- LIMPIEZA Y PAUSA DEL JUEGO ---
        if (window.gameState) {
            window.gameState.isPlaying = false;
            window.gameState.isPaused = false;
            window.gameState.isGameOver = false;
        }
        if (window.enemies) window.enemies = [];
        if (window.bullets) window.bullets = [];
        if (window.particles) window.particles = [];
        if (window.audioContext && window.audioContext.state === 'running') {
            window.audioContext.suspend();
        }
    };

    // Cerrar p√°gina de stats
    closeStatsBtn.onclick = function() {
        statsPage.classList.remove('active');
    };

    // ===================================
    // SETTINGS MENU - COMPLETE SYSTEM
    // ===================================
    const settingsMenu = document.getElementById('settingsMenu');
    const settingsBtn = document.getElementById('settingsBtn');
    const closeSettingsBtn = document.getElementById('closeSettingsBtn');

    // Default settings object (SIMPLIFIED)
    const defaultSettings = {
        masterVolume: 70,
        hapticFeedback: true,
        controlScheme: 'default', // 'default', 'inverted', or 'tap'
        controlSize: 'normal'
    };

    // Current settings (loaded from localStorage or defaults)
    let currentSettings = { ...defaultSettings };

    // Initialize all settings controls
    function initializeSettings() {
        // Load saved settings
        loadSettings();

        // === 1. VOLUME CONTROL ===
        const masterVolumeSlider = document.getElementById('masterVolume');
        masterVolumeSlider.addEventListener('input', function() {
            currentSettings.masterVolume = parseInt(this.value);
            document.getElementById('masterVolumeValue').textContent = this.value + '%';
            saveSettings();
            applyVolumeSettings();
        });

        // === 2. HAPTIC FEEDBACK ===
        const hapticToggle = document.getElementById('hapticToggle');
        hapticToggle.addEventListener('click', function() {
            currentSettings.hapticFeedback = !currentSettings.hapticFeedback;
            this.classList.toggle('active');
            saveSettings();
            // Test vibration
            if (currentSettings.hapticFeedback && navigator.vibrate) {
                navigator.vibrate(50);
            }
        });

        // === 3. CONTROL SCHEME ===
        const controlRadios = document.querySelectorAll('input[name="controlScheme"]');
        
        controlRadios.forEach(radio => {
            radio.addEventListener('change', function() {
                if (this.checked) {
                    currentSettings.controlScheme = this.value;
                    saveSettings();
                    applyControlScheme();
                }
            });
        });

        function applyControlScheme() {
            const scheme = currentSettings.controlScheme || 'default';
            
            // Set selected radio
            const radioToCheck = document.querySelector(`input[name="controlScheme"][value="${scheme}"]`);
            if (radioToCheck) {
                radioToCheck.checked = true;
            }
            
            // Apply to game
            if (typeof window.setControlMode === 'function') {
                window.setControlMode(scheme);
            }
        }

        // === 4. CONTROLS SIZE ===
        const sizeSmall = document.getElementById('sizeSmall');
        const sizeNormal = document.getElementById('sizeNormal');
        const sizeLarge = document.getElementById('sizeLarge');

        sizeSmall.addEventListener('click', function() {
            currentSettings.controlSize = 'small';
            updateSizeButtons();
            saveSettings();
            applyControlSize('small');
        });

        sizeNormal.addEventListener('click', function() {
            currentSettings.controlSize = 'normal';
            updateSizeButtons();
            saveSettings();
            applyControlSize('normal');
        });

        sizeLarge.addEventListener('click', function() {
            currentSettings.controlSize = 'large';
            updateSizeButtons();
            saveSettings();
            applyControlSize('large');
        });

        function updateSizeButtons() {
            sizeSmall.classList.toggle('active', currentSettings.controlSize === 'small');
            sizeNormal.classList.toggle('active', currentSettings.controlSize === 'normal');
            sizeLarge.classList.toggle('active', currentSettings.controlSize === 'large');
        }
    }

    // Load settings from localStorage
    function loadSettings() {
        const saved = localStorage.getItem('gameSettings');
        if (saved) {
            currentSettings = { ...defaultSettings, ...JSON.parse(saved) };
        }

        // Apply loaded values to UI
        document.getElementById('masterVolume').value = currentSettings.masterVolume;
        document.getElementById('masterVolumeValue').textContent = currentSettings.masterVolume + '%';

        document.getElementById('hapticToggle').classList.toggle('active', currentSettings.hapticFeedback);

        // Invert controls UI
        if (currentSettings.invertControls) {
            document.getElementById('modeShoot').classList.add('active');
            document.getElementById('modeMove').classList.remove('active');
        } else {
            document.getElementById('modeMove').classList.add('active');
            document.getElementById('modeShoot').classList.remove('active');
        }

        // Control size UI
        document.getElementById('sizeSmall').classList.toggle('active', currentSettings.controlSize === 'small');
        document.getElementById('sizeNormal').classList.toggle('active', currentSettings.controlSize === 'normal');
        document.getElementById('sizeLarge').classList.toggle('active', currentSettings.controlSize === 'large');

        // Apply all settings
        applyAllSettings();
    }

    // Save settings to localStorage
    function saveSettings() {
        localStorage.setItem('gameSettings', JSON.stringify(currentSettings));
    }

    // Apply all settings at once
    function applyAllSettings() {
        applyVolumeSettings();
        applyInvertControls();
        applyControlSize(currentSettings.controlSize);
    }

    // === APPLY FUNCTIONS ===

    // Volume Settings
    function applyVolumeSettings() {
        window.gameSettings = window.gameSettings || {};
        window.gameSettings.masterVolume = currentSettings.masterVolume / 100;

        // If audioContext exists, apply volumes
        if (window.audioContext) {
            if (window.musicGainNode) {
                window.musicGainNode.gain.value = currentSettings.masterVolume / 100;
            }
            if (window.effectsGainNode) {
                window.effectsGainNode.gain.value = currentSettings.masterVolume / 100;
            }
        }
    }

    // Haptic Feedback
    window.vibrate = function(duration = 50) {
        if (currentSettings.hapticFeedback && navigator.vibrate) {
            navigator.vibrate(duration);
        }
    };

    // Invert Controls
    function applyInvertControls() {
        window.gameSettings = window.gameSettings || {};
        window.gameSettings.invertControls = currentSettings.invertControls;

        // Swap joystick positions
        const joystickContainer = document.getElementById('joystickContainer');
        const shootJoystickContainer = document.getElementById('shootJoystickContainer');

        if (joystickContainer && shootJoystickContainer) {
            if (currentSettings.invertControls) {
                // Shoot on left, Move on right
                joystickContainer.style.left = 'auto';
                joystickContainer.style.right = 'clamp(15px, 3vw, 25px)';
                shootJoystickContainer.style.right = 'auto';
                shootJoystickContainer.style.left = 'clamp(15px, 3vw, 25px)';
            } else {
                // Move on left, Shoot on right (default)
                joystickContainer.style.left = 'clamp(15px, 3vw, 25px)';
                joystickContainer.style.right = 'auto';
                shootJoystickContainer.style.left = 'auto';
                shootJoystickContainer.style.right = 'clamp(15px, 3vw, 25px)';
            }
        }
    }

    // Control Size
    function applyControlSize(size) {
        window.gameSettings = window.gameSettings || {};
        window.gameSettings.controlSize = size;

        const mobileControls = document.getElementById('mobileControls');
        if (mobileControls) {
            mobileControls.classList.remove('size-small', 'size-normal', 'size-large');
            mobileControls.classList.add('size-' + size);
        }
    }

    // Open settings
    settingsBtn.onclick = function() {
        settingsMenu.classList.add('active');
        settingsMenu.style.display = 'block';
    };

    // Close settings
    closeSettingsBtn.onclick = function() {
        settingsMenu.classList.remove('active');
        settingsMenu.style.display = 'none';
    };

    // Initialize settings on page load
    initializeSettings();

    // ===================================
    // LOGOUT BUTTON
    // ===================================

    // Show/hide logout button based on login state
    function updateLogoutButtonVisibility() {
        const logoutItem = document.getElementById('logoutItem');
        if (logoutItem) {
            if (window.isGuestMode || !currentUser) {
                logoutItem.style.display = 'none';
            } else {
                logoutItem.style.display = 'block';
            }
        }
    }

    // Logout handler setup
    const logoutBtnElement = document.getElementById('logoutBtn');
    if (logoutBtnElement) {
        logoutBtnElement.onclick = function() {
            if (confirm('¬øEst√°s seguro de que quieres cerrar sesi√≥n?')) {
                auth.signOut().then(() => {
                    console.log('‚úÖ User logged out successfully');
                    // Reset UI to login screen
                    document.getElementById('loginContainer').style.display = 'block';
                    document.getElementById('userMenuContainer').style.display = 'none';
                    const settingsMenu = document.getElementById('settingsMenu');
                    if (settingsMenu) {
                        settingsMenu.style.display = 'none';
                        settingsMenu.classList.remove('active');
                    }
                    currentUser = null;
                    window.isGuestMode = false;
                }).catch((error) => {
                    console.error('‚ùå Error logging out:', error);
                    alert('Error al cerrar sesi√≥n. Intenta de nuevo.');
                });
            }
        };
    }

    // ===================================
    // STATS & RANKING
    // ===================================

    // Tabs
    tabBtns.forEach(btn => {
        btn.onclick = function() {
            const tab = this.dataset.tab;
            const period = this.dataset.period;
            tabBtns.forEach(b => b.classList.remove('active'));
            this.classList.add('active');
            document.querySelectorAll('.stats-content').forEach(c => c.classList.remove('active'));
            document.getElementById(tab).classList.add('active');
            loadRanking(tab);
            loadMyStats(period);
        };
    });

    // Cargar mis estad√≠sticas
    function loadMyStats() {
        // Accept period as argument, default to 'daily'
        let period = arguments.length > 0 ? arguments[0] : 'daily';
        if (!currentUser) return;
        const loadingDiv = document.getElementById('myStatsLoading');
        loadingDiv.style.display = 'block';
        document.getElementById('myStats').style.opacity = 0.5;

        let query = db.collection("ranking").where("userId", "==", currentUser.uid);
        const now = new Date();
        if (period === 'daily') {
            const startOfDay = new Date(now.getFullYear(), now.getMonth(), now.getDate());
            query = query.where("fecha", ">=", firebase.firestore.Timestamp.fromDate(startOfDay));
        } else if (period === 'monthly') {
            const startOfMonth = new Date(now.getFullYear(), now.getMonth(), now.getDate() - 29);
            query = query.where("fecha", ">=", firebase.firestore.Timestamp.fromDate(startOfMonth));
        }

        query.get().then(snapshot => {
            let totalGames = 0;
            let bestScore = 0;
            let bestWave = 0;
            let totalKills = 0;

            snapshot.forEach(doc => {
                const data = doc.data();
                totalGames++;
                if (data.score > bestScore) bestScore = data.score;
                if (data.wave > bestWave) bestWave = data.wave;
                totalKills += data.kills || 0;
            });

            document.getElementById('totalGames').textContent = totalGames;
            document.getElementById('bestScore').textContent = bestScore.toLocaleString();
            document.getElementById('bestWave').textContent = bestWave;
            document.getElementById('totalKills').textContent = totalKills.toLocaleString();
        }).finally(() => {
            loadingDiv.style.display = 'none';
            document.getElementById('myStats').style.opacity = 1;
        });
    }
    // My Stats filter buttons event removed; unified with tabBtns

    // Cargar ranking seg√∫n tab
    function loadRanking(tab) {
        // Mapear tabs a IDs correctos
        const tabMapping = {
            'daily-score': { tableId: 'dailyScoreTable', bodyId: 'dailyScoreBody', period: 'daily' },
            'monthly-score': { tableId: 'monthlyScoreTable', bodyId: 'monthlyScoreBody', period: 'monthly' },
            'alltime-score': { tableId: 'alltimeScoreTable', bodyId: 'alltimeScoreBody', period: 'alltime' }
        };

        const mapping = tabMapping[tab];
        if (!mapping) {
            console.error('Tab desconocido:', tab);
            return;
        }

        const { tableId, bodyId, period } = mapping;
        const loadingDiv = document.querySelector(`#${tab} .loading-stats`);
        const table = document.getElementById(tableId);

        // Mostrar loading
        if (loadingDiv) loadingDiv.style.display = 'block';
        if (table) table.style.display = 'none';

        let query = db.collection("ranking");
        const now = new Date();

        // Filtro por periodo y ordenar por score
        if (period === 'daily') {
            const startOfDay = new Date(now.getFullYear(), now.getMonth(), now.getDate());
            query = query.where('fecha', '>=', firebase.firestore.Timestamp.fromDate(startOfDay))
                         .orderBy('fecha', 'desc')
                         .orderBy('score', 'desc');
        } else if (period === 'monthly') {
            const last30Days = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);
            query = query.where('fecha', '>=', firebase.firestore.Timestamp.fromDate(last30Days))
                         .orderBy('fecha', 'desc')
                         .orderBy('score', 'desc');
        } else {
            // All-time: solo ordenar por score
            query = query.orderBy('score', 'desc');
        }

        // Obtener ranking completo
        query.limit(200).get()
            .then(snapshot => {
                const allResults = [];
                const userScores = {};

                snapshot.forEach(doc => {
                    const data = doc.data();
                    const userId = data.userId;

                    // Solo guardar la mejor partida de cada usuario (por score)
                    if (!userScores[userId] || data.score > userScores[userId].score) {
                        userScores[userId] = data;
                    }
                });

                // Convertir a array y ordenar por score
                for (let userId in userScores) {
                    allResults.push(userScores[userId]);
                }
                allResults.sort((a, b) => b.score - a.score);

                // Encontrar posici√≥n del usuario actual
                let userRank = -1;
                if (currentUser) {
                    userRank = allResults.findIndex(r => r.userId === currentUser.uid);
                }

                // Determinar qu√© resultados mostrar (10 arriba, usuario, 10 abajo)
                let displayResults = [];
                if (userRank === -1 || allResults.length <= 21) {
                    displayResults = allResults.slice(0, 21);
                } else if (userRank < 10) {
                    displayResults = allResults.slice(0, 21);
                } else if (userRank > allResults.length - 11) {
                    displayResults = allResults.slice(-21);
                } else {
                    displayResults = allResults.slice(userRank - 10, userRank + 11);
                }

                // Ocultar loading y mostrar tabla
                if (loadingDiv) loadingDiv.style.display = 'none';
                if (table) table.style.display = 'table';

                renderRankingTable(displayResults, bodyId, tableId, allResults);
            })
            .catch(error => {
                console.error('Error cargando ranking:', error);
                if (loadingDiv) {
                    loadingDiv.innerHTML = `
                        <div style="color: #ff4757; text-align: center; padding: 20px;">
                            <div style="font-size: 1.2em; margin-bottom: 10px;">‚ö†Ô∏è Index Required</div>
                            <div style="font-size: 0.9em;">Firebase needs a composite index for this query.</div>
                            <a href="${error.message.match(/https:\/\/[^\s]+/)}" target="_blank"
                               style="display: inline-block; margin-top: 10px; color: #00d4ff; text-decoration: none;
                                      background: rgba(0,212,255,0.1); padding: 8px 16px; border-radius: 8px;">
                                Create Index
                            </a>
                        </div>
                    `;
                }
            });
    }

    // Renderizar tabla de ranking
    function renderRankingTable(results, bodyId, tableId, allResults) {
        const tbody = document.getElementById(bodyId);
        const table = document.getElementById(tableId);

        if (!tbody || !table) {
            console.error('No se encontraron elementos:', { bodyId, tableId });
            return;
        }

        tbody.innerHTML = '';

        if (results.length === 0) {
            tbody.innerHTML = '<tr><td colspan="4" style="text-align:center;">No data available</td></tr>';
        } else {
            results.forEach((data, index) => {
                const actualRank = allResults.findIndex(r => r.userId === data.userId) + 1;
                const row = document.createElement('tr');
                if (currentUser && data.userId === currentUser.uid) {
                    row.classList.add('current-user');
                }

                let rankClass = '';
                if (actualRank === 1) rankClass = 'rank-gold';
                else if (actualRank === 2) rankClass = 'rank-silver';
                else if (actualRank === 3) rankClass = 'rank-bronze';

                row.innerHTML = `
                    <td><span class="rank-number ${rankClass}">#${actualRank}</span></td>
                    <td>${data.userName || 'Anonymous'}</td>
                    <td>${data.score.toLocaleString()}</td>
                    <td>${data.wave}</td>
                `;
                tbody.appendChild(row);
            });
        }

        table.style.display = 'table';
        table.previousElementSibling.style.display = 'none'; // Hide loading
    }
    </script>
    <script>
        // Custom cursor initialization (PC only)
        const isMobileCheck = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        if (!isMobileCheck) {
            document.body.classList.add('desktop');
            const cursor = document.getElementById('customCursor');
            cursor.classList.add('active');
            document.addEventListener('mousemove', (e) => {
                cursor.style.left = e.clientX + 'px';
                cursor.style.top = e.clientY + 'px';
            });
        }

        // PAUSE BUTTON LOGIC
    const pauseBtnMobile = document.getElementById('pauseBtnMobile');
    const pauseOverlay = document.getElementById('pauseOverlay');
    const resumeBtn = document.getElementById('resumeBtn');
    const abortBtn = document.getElementById('abortBtn');

        function togglePause() {
            if (window.gameState && window.gameState.isPlaying && !window.gameState.isGameOver) {
                if (!window.gameState.isPaused) {
                    window.gameState.isPaused = true;
                    pauseOverlay.style.display = 'flex';
                    document.getElementById('gameHUD').style.opacity = '0.3';
                } else {
                    window.gameState.isPaused = false;
                    pauseOverlay.style.display = 'none';
                    document.getElementById('gameHUD').style.opacity = '1';
                }
            }
        }

        if (pauseBtnMobile) {
            pauseBtnMobile.addEventListener('click', togglePause);
        }


        resumeBtn.addEventListener('click', () => {
            if (window.gameState && window.gameState.isPaused) {
                window.gameState.isPaused = false;
                pauseOverlay.style.display = 'none';
                document.getElementById('gameHUD').style.opacity = '1';
            }
        });

        // Bot√≥n abandonar partida
        abortBtn.addEventListener('click', () => {
            if (window.gameState && window.gameState.isPlaying && !window.gameState.isGameOver) {
                // Guardar la partida como ABORTED
                if (typeof window.guardarPartida === 'function') {
                    window.guardarPartida(window.gameState.score, window.gameState.wave, window.gameState.kills, 'ABORTED');
                }

                // Resetear completamente el estado del juego
                if (typeof window.resetGameState === 'function') {
                    window.resetGameState();
                }

                // Ocultar overlay de pausa
                pauseOverlay.style.display = 'none';

                // Ocultar HUD
                document.getElementById('gameHUD').classList.remove('active');

                // Mostrar men√∫ principal
                if (typeof startMenu !== 'undefined') {
                    startMenu.classList.remove('hidden');
                }
            }
        });

        // ESC key toggles pause
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                togglePause();
            }
        });

        // ===================================
        // UPGRADE MODAL SYSTEM
        // ===================================
        
        const upgradeModal = document.getElementById('upgradeModal');
        const xpBar = document.getElementById('xpBar');
        const xpText = document.getElementById('xpText');
        const xpEarnedText = document.getElementById('xpEarnedText');
        const enemyXpBreakdown = document.getElementById('enemyXpBreakdown');
        const upgradesGrid = document.getElementById('upgradesGrid');
        const undoUpgradesBtn = document.getElementById('undoUpgradesBtn');
        const acceptUpgradesBtn = document.getElementById('acceptUpgradesBtn');

        // Iconos para cada tipo de enemigo
        // Obtener iconos de enemigos desde game.js ENEMY_TYPES
        function getEnemyIcon(type) {
            if (typeof window.ENEMY_TYPES === 'undefined') return '‚¨§';
            
            const typeMap = {
                'normal': 'BASIC',
                'fast': 'FAST',
                'heavy': 'HEAVY',
                'superheavy': 'SUPERHEAVY',
                'explosive': 'EXPLOSIVE',
                'boss': 'BOSS'
            };
            
            const enemyType = window.ENEMY_TYPES[typeMap[type]];
            return enemyType ? enemyType.icon : '‚¨§';
        }

        // Nombres para cada tipo
        const enemyNames = {
            normal: 'Normal',
            fast: 'Fast',
            heavy: 'Heavy',
            superheavy: 'Super Heavy',
            explosive: 'Explosive',
            boss: 'Boss'
        };

        // Nombres bonitos para las stats
        const statNames = {
            movementSpeed: 'Movement Speed',
            fireRate: 'Fire Rate',
            resilience: 'Resilience',
            bulletDamage: 'Bullet Damage',
            maxHealth: 'Max Health',
            pickupMagnet: 'Pickup Magnet',
            criticalChance: 'Critical Chance',
            regeneration: 'Regeneration'
        };

        // Variable para rastrear XP al inicio del modal
        let xpAtModalStart = 0;

        // Mostrar modal de upgrades
        window.showUpgradeModal = function() {
            if (!window.gameState || !window.playerStats) {
                console.error('Game state or player stats not found');
                return;
            }

            // Guardar XP actual al abrir modal
            xpAtModalStart = window.gameState.experience;

            // Crear snapshot antes de mostrar el modal
            if (typeof window.createStatsSnapshot === 'function') {
                window.createStatsSnapshot();
            }

            // Actualizar texto de XP ganado
            const xpEarned = window.gameState.experienceThisWave.total;
            xpEarnedText.textContent = `You earned ${xpEarned} experience points this wave!`;

            // Actualizar barra de XP
            updateXPBar();

            // Renderizar breakdown de XP por enemigo
            renderEnemyXPBreakdown();

            // Renderizar grid de upgrades
            renderUpgradesGrid();

            // Mostrar modal
            upgradeModal.classList.add('active');
        };

        // Actualizar barra de XP
        function updateXPBar() {
            const currentXP = window.gameState.experience;
            
            // Calcular porcentaje basado en XP al inicio del modal
            const percentRemaining = xpAtModalStart > 0 ? (currentXP / xpAtModalStart) * 100 : 100;
            
            xpBar.style.width = `${Math.max(0, percentRemaining)}%`;
            xpText.textContent = `${currentXP} XP`;
        }

        // Renderizar breakdown de XP por tipo de enemigo
        function renderEnemyXPBreakdown() {
            enemyXpBreakdown.innerHTML = '';
            const breakdown = window.gameState.experienceThisWave;

            for (let type in breakdown) {
                if (type === 'total' || breakdown[type] === 0) continue;

                const item = document.createElement('div');
                item.className = 'enemy-xp-item';
                item.innerHTML = `
                    <div class="enemy-icon">${getEnemyIcon(type)}</div>
                    <div class="enemy-xp-amount">+${breakdown[type]} XP</div>
                    <div class="enemy-xp-label">${enemyNames[type] || type}</div>
                `;
                enemyXpBreakdown.appendChild(item);
            }
        }

        // Renderizar grid de upgrades
        function renderUpgradesGrid() {
            upgradesGrid.innerHTML = '';
            const stats = window.playerStats;

            for (let statName in stats) {
                const stat = stats[statName];
                const cost = stat.cost();
                const canAfford = window.gameState.experience >= cost;

                const card = document.createElement('div');
                card.className = 'upgrade-card';
                card.innerHTML = `
                    <div class="upgrade-header">
                        <div class="upgrade-name">${statNames[statName]}</div>
                        <div class="upgrade-level">Lv ${stat.level}</div>
                    </div>
                    <div class="upgrade-description">${stat.description}</div>
                    <div class="upgrade-footer">
                        <div class="upgrade-cost">${cost} XP</div>
                        <button class="upgrade-btn" ${!canAfford ? 'disabled' : ''} data-stat="${statName}">+</button>
                    </div>
                `;

                // Event listener para el bot√≥n
                const btn = card.querySelector('.upgrade-btn');
                btn.addEventListener('click', () => {
                    if (typeof window.upgradePlayerStat === 'function') {
                        const success = window.upgradePlayerStat(statName);
                        if (success) {
                            // Animaci√≥n de mejora
                            card.classList.add('upgrading');
                            setTimeout(() => card.classList.remove('upgrading'), 500);

                            // Actualizar barra de XP
                            updateXPBar();

                            // Re-renderizar
                            renderUpgradesGrid();
                        }
                    }
                });

                upgradesGrid.appendChild(card);
            }
        }

        // Bot√≥n de deshacer
        undoUpgradesBtn.addEventListener('click', () => {
            if (typeof window.restoreStatsSnapshot === 'function') {
                window.restoreStatsSnapshot();
                updateXPBar();
                renderUpgradesGrid();
            }
        });

        // Bot√≥n de aceptar
        acceptUpgradesBtn.addEventListener('click', () => {
            upgradeModal.classList.remove('active');
            
            // Resetear el tracking de XP de la oleada
            if (typeof window.resetWaveExperience === 'function') {
                window.resetWaveExperience();
            }

            // Continuar con la siguiente oleada
            if (typeof window.gameState !== 'undefined') {
                window.gameState.isCountdown = false;
                window.gameState.isPaused = false;
                
                // Iniciar countdown de la siguiente oleada
                if (typeof window.startNextWaveCountdown === 'function') {
                    window.startNextWaveCountdown();
                }
            }
        });

        // Exportar funci√≥n globalmente
        window.showUpgradeModal = window.showUpgradeModal;
    </script>
</body>
</html>